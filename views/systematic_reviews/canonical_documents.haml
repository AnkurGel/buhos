.heading
  %h2=title(t(:Systematic_review_canonical_documents, sr_name:@revision.nombre))


%ul.breadcrumb
  %li
    %a{:href=>url("/reviews")}=t(:Systematic_reviews)
  %li
    %a{:href=>url("/review/#{@revision.id}")}=@revision.nombre
  %li.active=t(:Canonical_documents)


%p
  =sprintf("<strong>#{t(:Count_canonical_documents)}</strong>: #{t(:Total)}=%d, #{t(:Records)}=%d, #{t(:References)}=%d",@ars.cd_count_total, @ars.cd_count_reg, @ars.cd_count_ref)

%p
  =t_desc_value(:Duplicated_DOI,@cd_rep_doi.length)

%form{:action=>url("/review/#{@revision[:id]}/canonical_documents"), :method=>:get,:class=>"form-inline"}
  %div{:class=>"input-group mb-2 mr-sm-2"}
    %input{:type=>:hidden,:name=>:pagina, :value=>@pager.page}
    %input{:type=>:hidden,:name=>:orden, :value=>@pager.order}
    %label{:class=>"", :for=>:busqueda}=t(:Search)
    %input{:type=>:text, :value=>@pager.query, :name=>:busqueda, :class=>"form-control"}
    .form-group-inline
      %label{:for=>:sin_abstract}=t(:Check_only_documents_without_abstract)
      %input{:type=>:checkbox, :name=>:sin_abstract, :class=>"form-control-checkbox", :value=>'true',:checked=>@sin_abstract}
    .form-group-inline
      %label{:for=>:solo_registros}=t(:Check_only_documents_on_search_no_references)
      %input{:type=>:checkbox, :name=>:solo_registros, :class=>"form-control-checkbox", :checked=>@solo_registros, :value=>'true'}
  %input{:type=>:submit, :class=>'btn btn-default '}
%div{:class=>"btn-group btn-group-sm", :role=>"group"}
  - if auth_to("review_admin")  or revision_pertenece_a(@revision.id, session['user_id'])
    %a{:href=>url("/review/#{@revision.id}/repeated_canonical_documents"), :role=>'button', :class=>"btn btn-default"}=t(:Check_duplications)
  - if auth_to("review_admin")  or revision_pertenece_a(@revision.id, session['user_id'])
    %a{:href=>url("/references/complete_canonical"), :role=>'button', :class=>"btn btn-default", :tooltip=>"Se revisan todas las referencias con DOI y se le une al canÃ³nico correspondiente"}
      %span{:class=>""}
      =t(:References_assign_canonical_documents)
  - if auth_to("review_admin")  or revision_pertenece_a(@revision.id, session['user_id'])
    %a{:href=>url("/canonical_documents/review/#{@revision.id}/complete_scopus_abstract")   , :role=>'button', :class=>"btn btn-default"}
      %span{:class=>""}
      =t(:Complete_abstract_using_Scopus)
  - if auth_to("review_admin")  or revision_pertenece_a(@revision.id, session['user_id'])
    %a{:href=>url("/canonical_documents/review/#{@revision.id}/automatic_categories")   , :role=>'button', :class=>"btn btn-default"}
      %span{:class=>""}
      =t(:Automatic_categories)
  %a{:href=>url("/review/#{@revision.id}/canonical_documents_graphml"),  :role=>'button', :class=>"btn btn-default"}
    %span{:class=>"glyphicon glyphicon-save"}
    =t(:Export_to_Graphml)
  %a{:href=>url("/review/#{@revision.id}/resolved_bibtex"),  :role=>'button', :class=>"btn btn-default"}
    %span{:class=>"glyphicon glyphicon-save"}
    =t(:Export_to_Bibtex)

%p
  %strong="#{t(:Count_search_documents)}:"
  =@cds_total


.btn-group
  -@criterios_orden.each do |crit_orden,crit_nombre|
    -["asc","desc"].each do |dir|
      -arrow_dir =  dir=="asc" ? "up" : "down"
      -if @pager.order!="#{crit_orden}__#{dir}"
        %a{:href=>url("/review/#{@revision[:id]}/canonical_documents?busqueda=#{@search}&orden=#{crit_orden}__#{dir}"), :class=>"btn btn-default btn-sm"}
          %span{:class=>"glyphicon glyphicon-chevron-#{arrow_dir}"}
          =crit_nombre
      -else
        %button{:class=>"btn btn-primary btn-sm"}
          %span{:class=>"glyphicon glyphicon-chevron-#{arrow_dir}"}
          =crit_nombre


= partial(:pager,:locals=>{url: @url, page: @pager.page, max_page: @pager.max_page,:extra=>{busqueda:@pager.query, sin_abstract:@sin_abstract, solo_registros:@solo_registros}} )
.list-group
  - #$log.info(@cds)
  - @cds.each do |cd|
    .list-group-item
      =CGI::escapeHTML cd.ref_apa_6_brief
      - #%p=sprintf("<strong>Referencias:</strong> citado por %d / referencia a %d", @ars.cd_count_entrada(cd[:id]).to_i, @ars.cd_count_salida(cd[:id]).to_i)
      %p=t(:References_count_to_canonical, in:cd[:n_total_referencias_recibidas].to_i, out:cd[:n_total_referencias_hechas].to_i, in_sta: cd[:n_referencias_rtr].to_i)


      %div
        =partial(:canonical_document_button_abstract_collapsible, :locals=>{cd:cd})


= partial(:pager,:locals=>{url: @url, page: @pager.page, max_page: @pager.max_page,:extra=>{busqueda:@pager.query, sin_abstract:@sin_abstract, solo_registros:@solo_registros}} )