- # Parametros: revision_id, cd (canonico_documento) | decisiones | ars | usuario_id | etapa)
- decision_o=decisiones[cd[:id]]
- decision = decision_o ? decision_o[:decision] : nil
- clase_panel=decision_class_bootstrap(decision,"panel")
- abs_pres=AbstractPresentation.new
- @revision||=Revision_Sistematica[revision_id]
- @nbayes_rs||=NBayes_RS.new(@revision)
- ajax||=false
- abs_pres.keywords =@revision.palabras_claves_as_array


%div{:class=>"panel #{clase_panel}"}
  %div{:class=>"panel-heading"}
    =CGI::escapeHTML cd.title
  %div{:class=>"panel-body"}
    %p
      %strong="#{t(:APA_references)}:"
      =CGI::escapeHTML cd.ref_apa_6

      - texto_referencias=sprintf("<strong>#{t(:Citations)}:</strong> #{t(:cites)} <strong>%d</strong> / #{t(:cited_by)} <strong>%d</strong> ", ars.cd_count_salida(cd[:id]).to_i, ars.cd_count_entrada(cd[:id]).to_i)
      - if ars.cd_count_entrada_rtr(cd[:id])
        -texto_referencias+=sprintf("/ #{t(:cited_by_RTR_documents)} <strong>%d</strong>", ars.cd_count_entrada_rtr(cd[:id]).to_i)
      %p=texto_referencias
    %p{:class=>""}
      %strong=t(:Abstract)
      - if !cd.abstract
        %em=t(:No_abstract)
      -else
        -#$log.info(cd)
        -abs_pres.text=cd.abstract
        -#$log.info(abs_pres)
        =abs_pres.html_with_keywords
    -if permiso("documentos_canonicos_editar")
      =partial(:canonico_documento_boton, :locals=>{id: cd[:id]})
    -if false and @nbayes_rs.cd_resultado(cd[:id])["no"]>0.5
      %div{:class=>"alert alert-warning"} SegÃºn el clasificar bayes, este texto no se asemeja mucho a los seleccionados previamente


  %div{:class=>"panel-footer"}
    .container
      .row
        .col-md-3.col-sm-5
          %strong=t(:Decision)
          .btn-group
            - crits={'yes'=>{bs:'success',nombre:t(:Yes)}, 'no'=>{bs:'danger',nombre:t(:No)}, 'undecided'=>{bs:'warning',nombre:t(:Undecided)}}
            - crits.each_pair do |dec_id, crit|
              -cbc=class_bootstrap_contextual( decision==dec_id, 'btn',crit[:bs] )
              -dc_dec= (decision==dec_id) ? '' : 'dc_decision'
              %button{:class=>"btn #{cbc} #{dc_dec}", "data-pk"=>cd[:id], "data-decision"=>dec_id, "data-user"=>usuario_id, "data-etapa"=>etapa ,:id=>"decision-#{cd[:id]}-#{dec_id}", 'data-url'=>"/decision/revision/#{revision_id}/usuario/#{usuario_id}/canonico_documento/#{cd[:id]}/etapa/#{etapa}/decision"}=crit[:nombre]
          %div
            %strong="#{t(:Commentary)}:"
            =a_textarea_editable(cd[:id], "comentario-cd", url("/decision/revision/#{revision_id}/usuario/#{usuario_id}/canonico_documento/#{cd[:id]}/etapa/#{etapa}/comentario"), decision_o  ?  decision_o.comentario : nil, t(:Enter_commentary))
        .col-md-8.col-sm-5
          =partial("tags/tags_cd_rs", :locals=>{cd: cd, revision:@revision,usuario_id:usuario_id, ajax:ajax})
