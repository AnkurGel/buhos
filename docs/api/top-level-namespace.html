<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Top Level Namespace
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo;
    
    
    <span class="title">Top Level Namespace</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Top Level Namespace
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="AnalysisSrStageMixin.html" title="AnalysisSrStageMixin (module)">AnalysisSrStageMixin</a></span>, <span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span>, <span class='object_link'><a href="DOIHelpers.html" title="DOIHelpers (module)">DOIHelpers</a></span>, <span class='object_link'><a href="FileHandler.html" title="FileHandler (module)">FileHandler</a></span>, <span class='object_link'><a href="HTMLHelpers.html" title="HTMLHelpers (module)">HTMLHelpers</a></span>, <span class='object_link'><a href="ReferenceIntegrator.html" title="ReferenceIntegrator (module)">ReferenceIntegrator</a></span>, <span class='object_link'><a href="ReferenceMethods.html" title="ReferenceMethods (module)">ReferenceMethods</a></span>, <span class='object_link'><a href="ReportBuilder.html" title="ReportBuilder (module)">ReportBuilder</a></span>, <span class='object_link'><a href="Scopus.html" title="Scopus (module)">Scopus</a></span>, <span class='object_link'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span>, <span class='object_link'><a href="SystematicReviewViewsMixin.html" title="SystematicReviewViewsMixin (module)">SystematicReviewViewsMixin</a></span>, <span class='object_link'><a href="TagBuilder.html" title="TagBuilder (module)">TagBuilder</a></span>, <span class='object_link'><a href="TagMixin.html" title="TagMixin (module)">TagMixin</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="AbstractPresentation.html" title="AbstractPresentation (class)">AbstractPresentation</a></span>, <span class='object_link'><a href="AllocationCd.html" title="AllocationCd (class)">AllocationCd</a></span>, <span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span>, <span class='object_link'><a href="AnalysisUserDecision.html" title="AnalysisUserDecision (class)">AnalysisUserDecision</a></span>, <span class='object_link'><a href="Analysis_SR_Stage.html" title="Analysis_SR_Stage (class)">Analysis_SR_Stage</a></span>, <span class='object_link'><a href="Authorization.html" title="Authorization (class)">Authorization</a></span>, <span class='object_link'><a href="AuthorizationsRole.html" title="AuthorizationsRole (class)">AuthorizationsRole</a></span>, <span class='object_link'><a href="BadCrossrefResponseError.html" title="BadCrossrefResponseError (class)">BadCrossrefResponseError</a></span>, <span class='object_link'><a href="BibliographicDatabase.html" title="BibliographicDatabase (class)">BibliographicDatabase</a></span>, <span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span>, <span class='object_link'><a href="CategorizerSr.html" title="CategorizerSr (class)">CategorizerSr</a></span>, <span class='object_link'><a href="CrossrefDoi.html" title="CrossrefDoi (class)">CrossrefDoi</a></span>, <span class='object_link'><a href="CrossrefQuery.html" title="CrossrefQuery (class)">CrossrefQuery</a></span>, <span class='object_link'><a href="Decision.html" title="Decision (class)">Decision</a></span>, <span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span>, <span class='object_link'><a href="FileSr.html" title="FileSr (class)">FileSr</a></span>, <span class='object_link'><a href="FormBuilder.html" title="FormBuilder (class)">FormBuilder</a></span>, <span class='object_link'><a href="GraphML_Builder.html" title="GraphML_Builder (class)">GraphML_Builder</a></span>, <span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span>, <span class='object_link'><a href="GroupsUser.html" title="GroupsUser (class)">GroupsUser</a></span>, <span class='object_link'><a href="IFile.html" title="IFile (class)">IFile</a></span>, <span class='object_link'><a href="Message.html" title="Message (class)">Message</a></span>, <span class='object_link'><a href="MessageSr.html" title="MessageSr (class)">MessageSr</a></span>, <span class='object_link'><a href="MessageSrSeen.html" title="MessageSrSeen (class)">MessageSrSeen</a></span>, <span class='object_link'><a href="NBayes_RS.html" title="NBayes_RS (class)">NBayes_RS</a></span>, <span class='object_link'><a href="Record.html" title="Record (class)">Record</a></span>, <span class='object_link'><a href="RecordCrossrefProcessor.html" title="RecordCrossrefProcessor (class)">RecordCrossrefProcessor</a></span>, <span class='object_link'><a href="RecordsReferences.html" title="RecordsReferences (class)">RecordsReferences</a></span>, <span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span>, <span class='object_link'><a href="ReferenceProcessor.html" title="ReferenceProcessor (class)">ReferenceProcessor</a></span>, <span class='object_link'><a href="Resolution.html" title="Resolution (class)">Resolution</a></span>, <span class='object_link'><a href="Result.html" title="Result (class)">Result</a></span>, <span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span>, <span class='object_link'><a href="ScopusRemote.html" title="ScopusRemote (class)">ScopusRemote</a></span>, <span class='object_link'><a href="Scopus_Abstract.html" title="Scopus_Abstract (class)">Scopus_Abstract</a></span>, <span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span>, <span class='object_link'><a href="SearchProcessor.html" title="SearchProcessor (class)">SearchProcessor</a></span>, <span class='object_link'><a href="SrField.html" title="SrField (class)">SrField</a></span>, <span class='object_link'><a href="Sr_Taxonomy.html" title="Sr_Taxonomy (class)">Sr_Taxonomy</a></span>, <span class='object_link'><a href="Sr_Taxonomy_Category.html" title="Sr_Taxonomy_Category (class)">Sr_Taxonomy_Category</a></span>, <span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span>, <span class='object_link'><a href="Systematic_Review_SRTC.html" title="Systematic_Review_SRTC (class)">Systematic_Review_SRTC</a></span>, <span class='object_link'><a href="T_Class.html" title="T_Class (class)">T_Class</a></span>, <span class='object_link'><a href="Tag.html" title="Tag (class)">Tag</a></span>, <span class='object_link'><a href="TagBwCd.html" title="TagBwCd (class)">TagBwCd</a></span>, <span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span>, <span class='object_link'><a href="TagInClass.html" title="TagInClass (class)">TagInClass</a></span>, <span class='object_link'><a href="User.html" title="User (class)">User</a></span>, <span class='object_link'><a href="UserDashboardInfo.html" title="UserDashboardInfo (class)">UserDashboardInfo</a></span>
    
  
</p>







  
    <h2>
      roles
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___admin_roles_-instance_route" title="#GET &#39;/admin/roles&#39; (instance route)">#<strong>GET &#39;/admin/roles&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of roles.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___role__id_-instance_route" title="#GET &#39;/role/:id&#39; (instance route)">#<strong>GET &#39;/role/:id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Information about a role.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___role__role_id_delete_-instance_route" title="#GET &#39;/role/:role_id/delete&#39; (instance route)">#<strong>GET &#39;/role/:role_id/delete&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deletes a role.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___role__role_id_edit_-instance_route" title="#GET &#39;/role/:role_id/edit&#39; (instance route)">#<strong>GET &#39;/role/:role_id/edit&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Form to update a role.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___role_new_-instance_route" title="#GET &#39;/role/new&#39; (instance route)">#<strong>GET &#39;/role/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Form to create a new role.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___role_update_-instance_route" title="#POST &#39;/role/update&#39; (instance route)">#<strong>POST &#39;/role/update&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      users
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___admin_users___-instance_route" title="#GET &#39;/admin/users/?&#39; (instance route)">#<strong>GET &#39;/admin/users/?&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get list of users.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___admin_users_update_-instance_route" title="#POST &#39;/admin/users/update&#39; (instance route)">#<strong>POST &#39;/admin/users/update&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update information for users.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      groups routes
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___admin_groups_-instance_route" title="#GET &#39;/admin/groups&#39; (instance route)">#<strong>GET &#39;/admin/groups&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Display list of groups.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___group__group_id_delete_-instance_route" title="#GET &#39;/group/:group_id/delete&#39; (instance route)">#<strong>GET &#39;/group/:group_id/delete&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deletes a group.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___group__id_datos_json_-instance_route" title="#GET &#39;/group/:id/datos.json&#39; (instance route)">#<strong>GET &#39;/group/:id/datos.json&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a json with information for a group.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___group_new_-instance_route" title="#GET &#39;/group/new&#39; (instance route)">#<strong>GET &#39;/group/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Display form to create a new group.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET__group__id-instance_route" title="#GET /group/:id (instance route)">#<strong>GET /group/:id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Display information for a group.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET__group__id_edit-instance_route" title="#GET /group/:id/edit (instance route)">#<strong>GET /group/:id/edit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Display form to edit a group.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___group_update_-instance_route" title="#POST &#39;/group/update&#39; (instance route)">#<strong>POST &#39;/group/update&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates information for a group.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Export
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_generate_bibtex_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/generate_bibtex&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/generate_bibtex&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a BibTeX file of documents on a specific stage.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_generate_doi_list_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/generate_doi_list&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/generate_doi_list&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a list of DOI of documents on a specific stage.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_generate_graphml_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/generate_graphml&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/generate_graphml&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a GraphML file of documents on a specific stage.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Personalized fields
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rs_id_field__fid_delete_-instance_route" title="#GET &#39;/review/:rs_id/field/:fid/delete&#39; (instance route)">#<strong>GET &#39;/review/:rs_id/field/:fid/delete&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Delete a field.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rs_id_fields_-instance_route" title="#GET &#39;/review/:rs_id/fields&#39; (instance route)">#<strong>GET &#39;/review/:rs_id/fields&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of personalized fields.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rs_id_update_field_table_-instance_route" title="#GET &#39;/review/:rs_id/update_field_table&#39; (instance route)">#<strong>GET &#39;/review/:rs_id/update_field_table&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update analysis table, using information provide on fields.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___review__rs_id_new_field_-instance_route" title="#POST &#39;/review/:rs_id/new_field&#39; (instance route)">#<strong>POST &#39;/review/:rs_id/new_field&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a new field.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___review_edit_field__attr_id__attr_-instance_route" title="#PUT &#39;/review/edit_field/:attr_id/:attr&#39; (instance route)">#<strong>PUT &#39;/review/edit_field/:attr_id/:attr&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Edit specific attribute of a field.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      report
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__sr_id_report__type__format_-instance_route" title="#GET &#39;/review/:sr_id/report/:type/:format&#39; (instance route)">#<strong>GET &#39;/review/:sr_id/report/:type/:format&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Provide a report.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      reflection
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___admin_authorizations_-instance_route" title="#GET &#39;/admin/authorizations&#39; (instance route)">#<strong>GET &#39;/admin/authorizations&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all authorizations used on system.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___admin_routes_-instance_route" title="#GET &#39;/admin/routes&#39; (instance route)">#<strong>GET &#39;/admin/routes&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all routes on system.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Searches
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_search_new_-instance_route" title="#GET &#39;/review/:id/search/new&#39; (instance route)">#<strong>GET &#39;/review/:id/search/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Form to create a new search.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_searches_-instance_route" title="#GET &#39;/review/:id/searches&#39; (instance route)">#<strong>GET &#39;/review/:id/searches&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of searches.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rs_id_searches_compare_records_-instance_route" title="#GET &#39;/review/:rs_id/searches/compare_records&#39; (instance route)">#<strong>GET &#39;/review/:rs_id/searches/compare_records&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Compare records betweeen searches.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rs_id_searches_user__user_id_-instance_route" title="#GET &#39;/review/:rs_id/searches/user/:user_id&#39; (instance route)">#<strong>GET &#39;/review/:rs_id/searches/user/:user_id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of searches for a user.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      stages administration
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_administration__stage_-instance_route" title="#GET &#39;/review/:id/administration/:stage&#39; (instance route)">#<strong>GET &#39;/review/:id/administration/:stage&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Interface to administrate a stage.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_administration_stages_-instance_route" title="#GET &#39;/review/:id/administration_stages&#39; (instance route)">#<strong>GET &#39;/review/:id/administration_stages&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of administration interfaces by stage.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_stage__stage_pattern__patron_resolution__resolution_-instance_route" title="#GET &#39;/review/:id/stage/:stage/pattern/:patron/resolution/:resolution&#39; (instance route)">#<strong>GET &#39;/review/:id/stage/:stage/pattern/:patron/resolution/:resolution&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set a resolution for a given pattern.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_administration__stage_cd_assignations_-instance_route" title="#GET &#39;/review/:rev_id/administration/:stage/cd_assignations&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/administration/:stage/cd_assignations&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of allocations of canonical documents to users.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_administration__stage_cd_without_allocations_-instance_route" title="#GET &#39;/review/:rev_id/administration/:stage/cd_without_allocations&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/administration/:stage/cd_without_allocations&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_add_assign_user__user_id__type_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/add_assign_user/:user_id/:type&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/add_assign_user/:user_id/:type&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Allocate canonical documents to a user if type=&#39;all&#39;, all documents
are allocated if type=&#39;without_allocation&#39;, only documents without
allocation are allocated.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_complete_empty_abstract_manual_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/complete_empty_abstract_manual&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/complete_empty_abstract_manual&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of documents without abstract.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_complete_empty_abstract_scopus_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/complete_empty_abstract_scopus&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/complete_empty_abstract_scopus&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Automatic retrieval of abstract from Scopus for documents without abstract.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_generar_references_crossref_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/generar_references_crossref&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/generar_references_crossref&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieve information from Crossref for all canonical documents approved for
a given stage.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__rev_id_stage__stage_rem_assign_user__user_id__type_-instance_route" title="#GET &#39;/review/:rev_id/stage/:stage/rem_assign_user/:user_id/:type&#39; (instance route)">#<strong>GET &#39;/review/:rev_id/stage/:stage/rem_assign_user/:user_id/:type&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove all documents allocations from a user.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Data extraction
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__sr_id_extract_information_cd__cd_id_-instance_route" title="#GET &#39;/review/:sr_id/extract_information/cd/:cd_id&#39; (instance route)">#<strong>GET &#39;/review/:sr_id/extract_information/cd/:cd_id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Form to retrieve information from a document in stage review full text.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___review__sr_id_extract_information_cd__cd_id_user__user_id_update_field_-instance_route" title="#PUT &#39;/review/:sr_id/extract_information/cd/:cd_id/user/:user_id/update_field&#39; (instance route)">#<strong>PUT &#39;/review/:sr_id/extract_information/cd/:cd_id/user/:user_id/update_field&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update information of a specific personalized field.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_document__id_-instance_route" title="#GET &#39;/canonical_document/:id&#39; (instance route)">#<strong>GET &#39;/canonical_document/:id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_document__id_get_crossref_data_-instance_route" title="#GET &#39;/canonical_document/:id/get_crossref_data&#39; (instance route)">#<strong>GET &#39;/canonical_document/:id/get_crossref_data&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_document__id_search_abstract_scopus_-instance_route" title="#GET &#39;/canonical_document/:id/search_abstract_scopus&#39; (instance route)">#<strong>GET &#39;/canonical_document/:id/search_abstract_scopus&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_document__id_search_crossref_references_-instance_route" title="#GET &#39;/canonical_document/:id/search_crossref_references&#39; (instance route)">#<strong>GET &#39;/canonical_document/:id/search_crossref_references&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_document__id_search_similar_-instance_route" title="#GET &#39;/canonical_document/:id/search_similar&#39; (instance route)">#<strong>GET &#39;/canonical_document/:id/search_similar&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_document__id_view_doi_-instance_route" title="#GET &#39;/canonical_document/:id/view_doi&#39; (instance route)">#<strong>GET &#39;/canonical_document/:id/view_doi&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_document__ref_id_clean_references_-instance_route" title="#GET &#39;/canonical_document/:ref_id/clean_references&#39; (instance route)">#<strong>GET &#39;/canonical_document/:ref_id/clean_references&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_documents_review__rev_id_automatic_categories_-instance_route" title="#GET &#39;/canonical_documents/review/:rev_id/automatic_categories&#39; (instance route)">#<strong>GET &#39;/canonical_documents/review/:rev_id/automatic_categories&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___canonical_documents_review__review_id_complete_abstract_scopus_-instance_route" title="#GET &#39;/canonical_documents/review/:review_id/complete_abstract_scopus&#39; (instance route)">#<strong>GET &#39;/canonical_documents/review/:review_id/complete_abstract_scopus&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___decision_review__review_id_user__user_id_canonical_document__cd_id_stage__stage_-instance_route" title="#GET &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage&#39; (instance route)">#<strong>GET &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___file__id_download_-instance_route" title="#GET &#39;/file/:id/download&#39; (instance route)">#<strong>GET &#39;/file/:id/download&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___file__id_page__pagina__format_-instance_route" title="#GET &#39;/file/:id/page/:pagina/:format&#39; (instance route)">#<strong>GET &#39;/file/:id/page/:pagina/:format&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___file__id_view_-instance_route" title="#GET &#39;/file/:id/view&#39; (instance route)">#<strong>GET &#39;/file/:id/view&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___files_rs__systematic_review_id_assign_to_canonical_documents_-instance_route" title="#GET &#39;/files/rs/:systematic_review_id/assign_to_canonical_documents&#39; (instance route)">#<strong>GET &#39;/files/rs/:systematic_review_id/assign_to_canonical_documents&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___my_messages_-instance_route" title="#GET &#39;/my_messages&#39; (instance route)">#<strong>GET &#39;/my_messages&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___record__id_-instance_route" title="#GET &#39;/record/:id&#39; (instance route)">#<strong>GET &#39;/record/:id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___record__id_assign_doi__doi_-instance_route" title="#GET &#39;/record/:id/assign_doi/:doi&#39; (instance route)">#<strong>GET &#39;/record/:id/assign_doi/:doi&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___record__id_search_crossref_-instance_route" title="#GET &#39;/record/:id/search_crossref&#39; (instance route)">#<strong>GET &#39;/record/:id/search_crossref&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___reference__id_-instance_route" title="#GET &#39;/reference/:id&#39; (instance route)">#<strong>GET &#39;/reference/:id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___reference__id_assign_doi__doi_-instance_route" title="#GET &#39;/reference/:id/assign_doi/:doi&#39; (instance route)">#<strong>GET &#39;/reference/:id/assign_doi/:doi&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___reference__id_search_crossref_-instance_route" title="#GET &#39;/reference/:id/search_crossref&#39; (instance route)">#<strong>GET &#39;/reference/:id/search_crossref&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___reference__id_search_similar_-instance_route" title="#GET &#39;/reference/:id/search_similar&#39; (instance route)">#<strong>GET &#39;/reference/:id/search_similar&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___references_search_crossref_by_doi__doi_-instance_route" title="#GET &#39;/references/search_crossref_by_doi/:doi&#39; (instance route)">#<strong>GET &#39;/references/search_crossref_by_doi/:doi&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_advance_stage_-instance_route" title="#GET &#39;/review/:id/advance_stage&#39; (instance route)">#<strong>GET &#39;/review/:id/advance_stage&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_canonical_documents_-instance_route" title="#GET &#39;/review/:id/canonical_documents&#39; (instance route)">#<strong>GET &#39;/review/:id/canonical_documents&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>DOCUMENTOS CANONICOS #####.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_canonical_documents_graphml_-instance_route" title="#GET &#39;/review/:id/canonical_documents_graphml&#39; (instance route)">#<strong>GET &#39;/review/:id/canonical_documents_graphml&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_files_-instance_route" title="#GET &#39;/review/:id/files&#39; (instance route)">#<strong>GET &#39;/review/:id/files&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_messages_-instance_route" title="#GET &#39;/review/:id/messages&#39; (instance route)">#<strong>GET &#39;/review/:id/messages&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_repeated_canonical_documents_-instance_route" title="#GET &#39;/review/:id/repeated_canonical_documents&#39; (instance route)">#<strong>GET &#39;/review/:id/repeated_canonical_documents&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_review_full_text_-instance_route" title="#GET &#39;/review/:id/review_full_text&#39; (instance route)">#<strong>GET &#39;/review/:id/review_full_text&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_screening_references_-instance_route" title="#GET &#39;/review/:id/screening_references&#39; (instance route)">#<strong>GET &#39;/review/:id/screening_references&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_screening_title_abstract_-instance_route" title="#GET &#39;/review/:id/screening_title_abstract&#39; (instance route)">#<strong>GET &#39;/review/:id/screening_title_abstract&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review__id_tags_-instance_route" title="#GET &#39;/review/:id/tags&#39; (instance route)">#<strong>GET &#39;/review/:id/tags&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___review_new_-instance_route" title="#GET &#39;/review/new&#39; (instance route)">#<strong>GET &#39;/review/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___reviews_-instance_route" title="#GET &#39;/reviews&#39; (instance route)">#<strong>GET &#39;/reviews&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_-instance_route" title="#GET &#39;/search/:id&#39; (instance route)">#<strong>GET &#39;/search/:id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_edit_-instance_route" title="#GET &#39;/search/:id/edit&#39; (instance route)">#<strong>GET &#39;/search/:id/edit&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_file_download_-instance_route" title="#GET &#39;/search/:id/file/download&#39; (instance route)">#<strong>GET &#39;/search/:id/file/download&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_invalidate_-instance_route" title="#GET &#39;/search/:id/invalidate&#39; (instance route)">#<strong>GET &#39;/search/:id/invalidate&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_records_-instance_route" title="#GET &#39;/search/:id/records&#39; (instance route)">#<strong>GET &#39;/search/:id/records&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_records_complete_doi_-instance_route" title="#GET &#39;/search/:id/records/complete_doi&#39; (instance route)">#<strong>GET &#39;/search/:id/records/complete_doi&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Completa la información desde Crossref para cada registro.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_references_-instance_route" title="#GET &#39;/search/:id/references&#39; (instance route)">#<strong>GET &#39;/search/:id/references&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_references_generate_canonical_doi__n_-instance_route" title="#GET &#39;/search/:id/references/generate_canonical_doi/:n&#39; (instance route)">#<strong>GET &#39;/search/:id/references/generate_canonical_doi/:n&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_references_search_doi_-instance_route" title="#GET &#39;/search/:id/references/search_doi&#39; (instance route)">#<strong>GET &#39;/search/:id/references/search_doi&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Busca en el text algun indicador de DOI.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___search__id_validate_-instance_route" title="#GET &#39;/search/:id/validate&#39; (instance route)">#<strong>GET &#39;/search/:id/validate&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tag__tag_id_rs__rs_id_cds_-instance_route" title="#GET &#39;/tag/:tag_id/rs/:rs_id/cds&#39; (instance route)">#<strong>GET &#39;/tag/:tag_id/rs/:rs_id/cds&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tag__tag_id_rs__rs_id_stage__stage_cds_-instance_route" title="#GET &#39;/tag/:tag_id/rs/:rs_id/stage/:stage/cds&#39; (instance route)">#<strong>GET &#39;/tag/:tag_id/rs/:rs_id/stage/:stage/cds&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tags_basic_10_json_-instance_route" title="#GET &#39;/tags/basic_10.json&#39; (instance route)">#<strong>GET &#39;/tags/basic_10.json&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tags_basic_ref_10_json_-instance_route" title="#GET &#39;/tags/basic_ref_10.json&#39; (instance route)">#<strong>GET &#39;/tags/basic_ref_10.json&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tags_query_json__query_-instance_route" title="#GET &#39;/tags/query_json/:query&#39; (instance route)">#<strong>GET &#39;/tags/query_json/:query&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tags_refs_query_json__query_-instance_route" title="#GET &#39;/tags/refs/query_json/:query&#39; (instance route)">#<strong>GET &#39;/tags/refs/query_json/:query&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tags_systematic_review__rs_id_query_json__query_-instance_route" title="#GET &#39;/tags/systematic_review/:rs_id/query_json/:query&#39; (instance route)">#<strong>GET &#39;/tags/systematic_review/:rs_id/query_json/:query&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___tags_systematic_review__rs_id_ref_query_json__query_-instance_route" title="#GET &#39;/tags/systematic_review/:rs_id/ref/query_json/:query&#39; (instance route)">#<strong>GET &#39;/tags/systematic_review/:rs_id/ref/query_json/:query&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___user__user_id_-instance_route" title="#GET &#39;/user/:user_id&#39; (instance route)">#<strong>GET &#39;/user/:user_id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___user__user_id_change_password_-instance_route" title="#GET &#39;/user/:user_id/change_password&#39; (instance route)">#<strong>GET &#39;/user/:user_id/change_password&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___user__user_id_compose_message_-instance_route" title="#GET &#39;/user/:user_id/compose_message&#39; (instance route)">#<strong>GET &#39;/user/:user_id/compose_message&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___user__user_id_edit_-instance_route" title="#GET &#39;/user/:user_id/edit&#39; (instance route)">#<strong>GET &#39;/user/:user_id/edit&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___user__user_id_messages_-instance_route" title="#GET &#39;/user/:user_id/messages&#39; (instance route)">#<strong>GET &#39;/user/:user_id/messages&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___ViewerJS__-instance_route" title="#GET &#39;/ViewerJS/&#39; (instance route)">#<strong>GET &#39;/ViewerJS/&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET___ViewerJS___file__id_download_-instance_route" title="#GET &#39;/ViewerJS/..file/:id/download&#39; (instance route)">#<strong>GET &#39;/ViewerJS/..file/:id/download&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET__review__id-instance_route" title="#GET /review/:id (instance route)">#<strong>GET /review/:id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#GET__review__id_edit-instance_route" title="#GET /review/:id/edit (instance route)">#<strong>GET /review/:id/edit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___canonical_document__id_merge_similar_references_-instance_route" title="#POST &#39;/canonical_document/:id/merge_similar_references&#39; (instance route)">#<strong>POST &#39;/canonical_document/:id/merge_similar_references&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___canonical_document_merge_-instance_route" title="#POST &#39;/canonical_document/merge&#39; (instance route)">#<strong>POST &#39;/canonical_document/merge&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___canonical_document_user_assignation__accion_-instance_route" title="#POST &#39;/canonical_document/user_assignation/:accion&#39; (instance route)">#<strong>POST &#39;/canonical_document/user_assignation/:accion&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___decision_review__review_id_user__user_id_canonical_document__cd_id_stage__stage_decision_-instance_route" title="#POST &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/decision&#39; (instance route)">#<strong>POST &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/decision&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___file_assign_to_canonical_-instance_route" title="#POST &#39;/file/assign_to_canonical&#39; (instance route)">#<strong>POST &#39;/file/assign_to_canonical&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___file_delete_-instance_route" title="#POST &#39;/file/delete&#39; (instance route)">#<strong>POST &#39;/file/delete&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___file_hide_cd_-instance_route" title="#POST &#39;/file/hide_cd&#39; (instance route)">#<strong>POST &#39;/file/hide_cd&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___file_show_cd_-instance_route" title="#POST &#39;/file/show_cd&#39; (instance route)">#<strong>POST &#39;/file/show_cd&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___file_unassign_cd_-instance_route" title="#POST &#39;/file/unassign_cd&#39; (instance route)">#<strong>POST &#39;/file/unassign_cd&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___file_unassign_sr_-instance_route" title="#POST &#39;/file/unassign_sr&#39; (instance route)">#<strong>POST &#39;/file/unassign_sr&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___message__m_id_seen_by__user_id_-instance_route" title="#POST &#39;/message/:m_id/seen_by/:user_id&#39; (instance route)">#<strong>POST &#39;/message/:m_id/seen_by/:user_id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___message_per__m_id_reply_-instance_route" title="#POST &#39;/message_per/:m_id/reply&#39; (instance route)">#<strong>POST &#39;/message_per/:m_id/reply&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___message_sr__ms_id_reply_-instance_route" title="#POST &#39;/message_sr/:ms_id/reply&#39; (instance route)">#<strong>POST &#39;/message_sr/:ms_id/reply&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___message_sr__ms_id_seen_by__user_id_-instance_route" title="#POST &#39;/message_sr/:ms_id/seen_by/:user_id&#39; (instance route)">#<strong>POST &#39;/message_sr/:ms_id/seen_by/:user_id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___record__id_manual_references_-instance_route" title="#POST &#39;/record/:id/manual_references&#39; (instance route)">#<strong>POST &#39;/record/:id/manual_references&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___reference__id_merge_similar_references_-instance_route" title="#POST &#39;/reference/:id/merge_similar_references&#39; (instance route)">#<strong>POST &#39;/reference/:id/merge_similar_references&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___resolution_review__id_canonical_document__cd_id_stage__stage_resolution_-instance_route" title="#POST &#39;/resolution/review/:id/canonical_document/:cd_id/stage/:stage/resolution&#39; (instance route)">#<strong>POST &#39;/resolution/review/:id/canonical_document/:cd_id/stage/:stage/resolution&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___review__id_message_new_-instance_route" title="#POST &#39;/review/:id/message/new&#39; (instance route)">#<strong>POST &#39;/review/:id/message/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___review_files_add_-instance_route" title="#POST &#39;/review/files/add&#39; (instance route)">#<strong>POST &#39;/review/files/add&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___review_update_-instance_route" title="#POST &#39;/review/update&#39; (instance route)">#<strong>POST &#39;/review/update&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___search_update_-instance_route" title="#POST &#39;/search/update&#39; (instance route)">#<strong>POST &#39;/search/update&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___searches_update_batch_-instance_route" title="#POST &#39;/searches/update_batch&#39; (instance route)">#<strong>POST &#39;/searches/update_batch&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___tag_delete_rs_-instance_route" title="#POST &#39;/tag/delete_rs&#39; (instance route)">#<strong>POST &#39;/tag/delete_rs&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___tags_cd__cd_id_rs__rs_id__accion_-instance_route" title="#POST &#39;/tags/cd/:cd_id/rs/:rs_id/:accion&#39; (instance route)">#<strong>POST &#39;/tags/cd/:cd_id/rs/:rs_id/:accion&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___tags_cd_start__cd_start_id_cd_end__cd_end_id_rs__rs_id__accion_-instance_route" title="#POST &#39;/tags/cd_start/:cd_start_id/cd_end/:cd_end_id/rs/:rs_id/:accion&#39; (instance route)">#<strong>POST &#39;/tags/cd_start/:cd_start_id/cd_end/:cd_end_id/rs/:rs_id/:accion&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___tags_class__t_clase_id_add_tag_-instance_route" title="#POST &#39;/tags/class/:t_clase_id/add_tag&#39; (instance route)">#<strong>POST &#39;/tags/class/:t_clase_id/add_tag&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___tags_class__t_clase_id_remove_tag_-instance_route" title="#POST &#39;/tags/class/:t_clase_id/remove_tag&#39; (instance route)">#<strong>POST &#39;/tags/class/:t_clase_id/remove_tag&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___tags_classes_new_-instance_route" title="#POST &#39;/tags/classes/new&#39; (instance route)">#<strong>POST &#39;/tags/classes/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___user__user_id_change_password_-instance_route" title="#POST &#39;/user/:user_id/change_password&#39; (instance route)">#<strong>POST &#39;/user/:user_id/change_password&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#POST___user__user_id_compose_message_send_-instance_route" title="#POST &#39;/user/:user_id/compose_message/send&#39; (instance route)">#<strong>POST &#39;/user/:user_id/compose_message/send&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___authorization_user__user_id_review__rs_id_cd__cd_id_stage__stage_id_edit_instruction_-instance_route" title="#PUT &#39;/authorization/user/:user_id/review/:rs_id/cd/:cd_id/stage/:stage_id/edit_instruction&#39; (instance route)">#<strong>PUT &#39;/authorization/user/:user_id/review/:rs_id/cd/:cd_id/stage/:stage_id/edit_instruction&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___canonical_document_edit_field__field_-instance_route" title="#PUT &#39;/canonical_document/edit_field/:field&#39; (instance route)">#<strong>PUT &#39;/canonical_document/edit_field/:field&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Metodo rapido.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___decision_review__review_id_user__user_id_canonical_document__cd_id_stage__stage_commentary_-instance_route" title="#PUT &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/commentary&#39; (instance route)">#<strong>PUT &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/commentary&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___file_edit_field__campo_-instance_route" title="#PUT &#39;/file/edit_field/:campo&#39; (instance route)">#<strong>PUT &#39;/file/edit_field/:campo&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Method put.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___tags_classes_edit_field__field_-instance_route" title="#PUT &#39;/tags/classes/edit_field/:field&#39; (instance route)">#<strong>PUT &#39;/tags/classes/edit_field/:field&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT___user_edit__field_-instance_route" title="#PUT &#39;/user/edit/:field&#39; (instance route)">#<strong>PUT &#39;/user/edit/:field&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#PUT__tag_edit-instance_route" title="#PUT /tag/edit (instance route)">#<strong>PUT /tag/edit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="GET___admin_authorizations_-instance_route">
  
    #<strong>GET &#39;/admin/authorizations&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all authorizations used on system</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24
25
26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/reflection.rb', line 22</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/authorizations</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reflection</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_auth'>auth</span><span class='op'>=</span><span class='const'>Buhos</span><span class='op'>::</span><span class='const'>Reflection</span><span class='period'>.</span><span class='id identifier rubyid_get_authorizations'>get_authorizations</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='ivar'>@files</span><span class='op'>=</span><span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_files'>files</span>
  <span class='ivar'>@permits</span><span class='op'>=</span><span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_permits'>permits</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin/permits</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___admin_groups_-instance_route">
  
    #<strong>GET &#39;/admin/groups&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Display list of groups</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/groups.rb', line 11</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/groups</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@groups</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:groups</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___admin_roles_-instance_route">
  
    #<strong>GET &#39;/admin/roles&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>List of roles</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/roles.rb', line 11</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/roles</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@roles</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span>
  <span class='ivar'>@authorizations</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Authorization.html" title="Authorization (class)">Authorization</a></span></span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin/roles</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___admin_routes_-instance_route">
  
    #<strong>GET &#39;/admin/routes&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all routes on system</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/reflection.rb', line 12</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/routes</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reflection</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/Reflection.html" title="Buhos::Reflection (module)">Reflection</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_routes'><span class='object_link'><a href="Buhos/Reflection.html#get_routes-class_method" title="Buhos::Reflection.get_routes (method)">get_routes</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;html&gt;&lt;body&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lines'>lines</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;br/&gt;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/body&gt;&lt;/html&gt;</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___admin_users___-instance_route">
  
    #<strong>GET &#39;/admin/users/?&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get list of users</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/users.rb', line 12</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/users/?</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@usr_bus</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:users_search</span><span class='rbracket'>]</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='ivar'>@usr_bus</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='ivar'>@usr_bus</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@users</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='ivar'>@users</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_filter'>filter</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_like'>like</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%</span><span class='embexpr_beg'>#{</span><span class='ivar'>@usr_bus</span><span class='embexpr_end'>}</span><span class='tstring_content'>%</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='comment'>#log.info(@personas.all)  
</span>  <span class='ivar'>@roles</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:users</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_document__id_-instance_route">
  
    #<strong>GET &#39;/canonical_document/:id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 12</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoCdIdError.html" title="Buhos::NoCdIdError (class)">NoCdIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@cd</span>
  <span class='ivar'>@records</span><span class='op'>=</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_records'>records</span>
  <span class='ivar'>@references</span><span class='op'>=</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span>
  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="CrossrefDoi.html" title="CrossrefDoi (class)">CrossrefDoi</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='ivar'>@cr_doi</span><span class='op'>=</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_crossref_integrator'>crossref_integrator</span>
  <span class='kw'>end</span>

  <span class='ivar'>@references_realizadas</span><span class='op'>=</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_references_performed'>references_performed</span>
  <span class='id identifier rubyid_title'>title</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_title</span><span class='comma'>,</span> <span class='label'>cd_title:</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_ref_apa_6'>ref_apa_6</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:canonical_document</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_document__id_get_crossref_data_-instance_route">
  
    #<strong>GET &#39;/canonical_document/:id/get_crossref_data&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 46</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:id/get_crossref_data</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_crossref_integrator'>crossref_integrator</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Crossref agregado para </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error al agregar Crossref para </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_document__id_search_abstract_scopus_-instance_route">
  
    #<strong>GET &#39;/canonical_document/:id/search_abstract_scopus&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 128</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:id/search_abstract_scopus</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Scopus_Abstract.html" title="Scopus_Abstract (class)">Scopus_Abstract</a></span></span><span class='period'>.</span><span class='id identifier rubyid_obtener_abstract_cd'><span class='object_link'><a href="Scopus_Abstract.html#obtener_abstract_cd-class_method" title="Scopus_Abstract.obtener_abstract_cd (method)">obtener_abstract_cd</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_document__id_search_crossref_references_-instance_route">
  
    #<strong>GET &#39;/canonical_document/:id/search_crossref_references&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 28</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:id/search_crossref_references</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_references'>references</span><span class='op'>=</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_references_performed'>references_performed</span><span class='period'>.</span><span class='id identifier rubyid_exclude'>exclude</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_references'>references</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:no_references_to_search_on_crossref</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_references'>references</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_document__id_search_similar_-instance_route">
  
    #<strong>GET &#39;/canonical_document/:id/search_similar&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 58</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:id/search_similar</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoCdIdError.html" title="Buhos::NoCdIdError (class)">NoCdIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@cd</span>

  <span class='ivar'>@ajax</span><span class='op'>=</span><span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ajax</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@distancia</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>distancia</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@distancia</span><span class='op'>=</span><span class='int'>30</span> <span class='kw'>if</span> <span class='ivar'>@distancia</span><span class='op'>==</span><span class='int'>0</span>
  <span class='ivar'>@ref_similares</span><span class='op'>=</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_buscar_references_similares'>buscar_references_similares</span><span class='lparen'>(</span><span class='ivar'>@distancia</span><span class='rparen'>)</span>
  <span class='comment'>##$log.info(@ref_similares)
</span>  <span class='kw'>if</span> <span class='ivar'>@ajax</span>
    <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical_documents/reference_search_similar</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='symbol'>:layout</span><span class='op'>=&gt;</span><span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical_documents/reference_search_similar</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_document__id_view_doi_-instance_route">
  
    #<strong>GET &#39;/canonical_document/:id/view_doi&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


178
179
180
181
182
183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 178</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:id/view_doi</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoCdIdError.html" title="Buhos::NoCdIdError (class)">NoCdIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@cd</span>
  <span class='ivar'>@cr_doi</span><span class='op'>=</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_crossref_integrator'>crossref_integrator</span>
  <span class='ivar'>@doi_json</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CrossrefDoi.html" title="CrossrefDoi (class)">CrossrefDoi</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_doi_without_http'>doi_without_http</span><span class='lparen'>(</span><span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:json</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical_documents/view_doi</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_document__ref_id_clean_references_-instance_route">
  
    #<strong>GET &#39;/canonical_document/:ref_id/clean_references&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 135</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:ref_id/clean_references</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:doi</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Las references para canonico </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> estan limpias</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_documents_review__rev_id_automatic_categories_-instance_route">
  
    #<strong>GET &#39;/canonical_documents/review/:rev_id/automatic_categories&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149
150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 143</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_documents/review/:rev_id/automatic_categories</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@cd_hash</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_cd_hash'>cd_hash</span>
  <span class='comment'>#require &#39;categorize&#39;
</span>  <span class='comment'>#modelo=Categorize::Models::Cluster.new
</span>  <span class='comment'>#modelo.num_clusters = 20
</span>  <span class='ivar'>@categorizador</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CategorizerSr.html" title="CategorizerSr (class)">CategorizerSr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="CategorizerSr.html#initialize-instance_method" title="CategorizerSr#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/canonical_documents_automatic_categories</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___canonical_documents_review__review_id_complete_abstract_scopus_-instance_route">
  
    #<strong>GET &#39;/canonical_documents/review/:review_id/complete_abstract_scopus&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120
121
122
123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 114</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_documents/review/:review_id/complete_abstract_scopus</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@rev</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>

  <span class='ivar'>@cd_wo_abstract</span><span class='op'>=</span><span class='ivar'>@rev</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_lit'>lit</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>abstract IS NULL OR abstract=&#39;&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select_map'>select_map</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Se procesan </span><span class='embexpr_beg'>#{</span><span class='ivar'>@cd_wo_abstract</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'> documentos canonicos</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@cd_wo_abstract</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cd'>cd</span><span class='op'>|</span>
    <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Scopus_Abstract.html" title="Scopus_Abstract (class)">Scopus_Abstract</a></span></span><span class='period'>.</span><span class='id identifier rubyid_obtener_abstract_cd'><span class='object_link'><a href="Scopus_Abstract.html#obtener_abstract_cd-class_method" title="Scopus_Abstract.obtener_abstract_cd (method)">obtener_abstract_cd</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___decision_review__review_id_user__user_id_canonical_document__cd_id_stage__stage_-instance_route">
  
    #<strong>GET &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/decision.rb', line 8</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_review'>review</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_review_id'>review_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_ars'>ars</span><span class='op'>=</span><span class='const'>AnalysisSystematicReview</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_review'>review</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_usuario'>usuario</span><span class='op'>=</span><span class='const'>User</span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_decisions'>decisions</span><span class='op'>=</span><span class='const'>Decision</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:systematic_review_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span>
                            <span class='symbol'>:stage</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_as_hash'>as_hash</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_review'>review</span> <span class='kw'>or</span> <span class='op'>!</span><span class='id identifier rubyid_cd'>cd</span> <span class='kw'>or</span> <span class='op'>!</span><span class='id identifier rubyid_usuario'>usuario</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>500</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No existe alguno de los componentes</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_partial'>partial</span><span class='lparen'>(</span><span class='symbol'>:decision</span><span class='comma'>,</span> <span class='symbol'>:locals</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='label'>review:</span> <span class='id identifier rubyid_review'>review</span><span class='comma'>,</span> <span class='label'>cd:</span> <span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span> <span class='label'>decisions:</span> <span class='id identifier rubyid_decisions'>decisions</span><span class='comma'>,</span> <span class='label'>ars:</span> <span class='id identifier rubyid_ars'>ars</span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='label'>stage:</span> <span class='id identifier rubyid_stage'>stage</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___file__id_download_-instance_route">
  
    #<strong>GET &#39;/file/:id/download&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 77</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/:id/download</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'>#headers[&quot;Content-Disposition&quot;] = &quot;attachment;filename=#{file[:filename]}&quot;
</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_send_file'>send_file</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_absolute_path'>absolute_path</span><span class='lparen'>(</span><span class='id identifier rubyid_dir_files'>dir_files</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___file__id_page__pagina__format_-instance_route">
  
    #<strong>GET &#39;/file/:id/page/:pagina/:format&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 92</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/:id/page/:pagina/:format</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='id identifier rubyid_pagina'>pagina</span><span class='comma'>,</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_pagina'>pagina</span><span class='op'>=</span><span class='id identifier rubyid_pagina'>pagina</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_filepath'>filepath</span><span class='op'>=</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_absolute_path'>absolute_path</span><span class='lparen'>(</span><span class='id identifier rubyid_dir_files'>dir_files</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application/pdf</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>begin</span> 
      <span class='kw'>if</span> <span class='id identifier rubyid_format'>format</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pdf-reader</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_reader'>reader</span><span class='op'>=</span><span class='const'>PDF</span><span class='op'>::</span><span class='const'>Reader</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_filepath'>filepath</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:pages</span><span class='op'>=&gt;</span><span class='id identifier rubyid_reader'>reader</span><span class='period'>.</span><span class='id identifier rubyid_pages'>pages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:pages</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No existe pagina</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_reader'>reader</span><span class='period'>.</span><span class='id identifier rubyid_pages'>pages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>&lt;</span><span class='id identifier rubyid_pagina'>pagina</span>
        <span class='id identifier rubyid_reader'>reader</span><span class='period'>.</span><span class='id identifier rubyid_pages'>pages</span><span class='lbracket'>[</span><span class='id identifier rubyid_pagina'>pagina</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_format'>format</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>image</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>grim</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_pdf'>pdf</span>   <span class='op'>=</span> <span class='const'>Grim</span><span class='period'>.</span><span class='id identifier rubyid_reap'>reap</span><span class='lparen'>(</span><span class='id identifier rubyid_filepath'>filepath</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No existe pagina</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_pdf'>pdf</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='op'>&lt;</span><span class='id identifier rubyid_pagina'>pagina</span> <span class='kw'>or</span> <span class='id identifier rubyid_pagina'>pagina</span><span class='op'>&lt;</span><span class='int'>1</span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:pages</span><span class='op'>=&gt;</span><span class='id identifier rubyid_pdf'>pdf</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:pages</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_filepath_image'>filepath_image</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dir_files'>dir_files</span><span class='embexpr_end'>}</span><span class='tstring_content'>/pdf_imagenes/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:sha256</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:sha256</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pagina'>pagina</span><span class='embexpr_end'>}</span><span class='tstring_content'>.png</span><span class='tstring_end'>&quot;</span></span>
        <span class='comment'>#$log.info(File.dirname(filepath_image))
</span>        <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_filepath_image'>filepath_image</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_filepath_image'>filepath_image</span><span class='rparen'>)</span>
        <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_filepath_image'>filepath_image</span>
          <span class='id identifier rubyid_pdf'>pdf</span><span class='lbracket'>[</span><span class='id identifier rubyid_pagina'>pagina</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span><span class='lparen'>(</span><span class='id identifier rubyid_filepath_image'>filepath_image</span><span class='comma'>,</span><span class='lbrace'>{</span>
              <span class='symbol'>:density</span><span class='op'>=&gt;</span><span class='int'>300</span><span class='comma'>,</span>
              <span class='symbol'>:alpha</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Set</span><span class='tstring_end'>&quot;</span></span>
          <span class='rbrace'>}</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inline;filename=</span><span class='embexpr_beg'>#{</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_filepath_image'>filepath_image</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>image/png</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_send_file'>send_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filepath_image'>filepath_image</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:cant_process</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span>
      <span class='id identifier rubyid_halt'>halt</span> <span class='int'>500</span><span class='comma'>,</span> <span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error on processing file</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='int'>500</span>
  <span class='kw'>end</span>
<span class='comment'>#  headers[&quot;Content-Disposition&quot;] = &quot;inline;filename=#{file[:filename]}&quot;
</span>
<span class='comment'>#  content_type file[:filetype]
</span><span class='comment'>#  send_file(file.absolute_path(dir_files))
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___file__id_view_-instance_route">
  
    #<strong>GET &#39;/file/:id/view&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


142
143
144
145
146
147
148
149
150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 142</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/:id/view</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inline;filename=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_content_type'>content_type</span> <span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_send_file'>send_file</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_absolute_path'>absolute_path</span><span class='lparen'>(</span><span class='id identifier rubyid_dir_files'>dir_files</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___files_rs__systematic_review_id_assign_to_canonical_documents_-instance_route">
  
    #<strong>GET &#39;/files/rs/:systematic_review_id/assign_to_canonical_documents&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 8</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/files/rs/:systematic_review_id/assign_to_canonical_documents</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rs'>rs</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rs'>rs</span>


  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pdf-reader</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># Solo buscar en los files que no tienen canonico asignado
</span>  <span class='id identifier rubyid_pdf_por_revisar'>pdf_por_revisar</span><span class='op'>=</span><span class='const'>FileSr</span><span class='period'>.</span><span class='id identifier rubyid_files_sin_cd'>files_sin_cd</span><span class='lparen'>(</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:filetype</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/pdf</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pdf_por_revisar'>pdf_por_revisar</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pdf'>pdf</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_reader'>reader</span><span class='op'>=</span><span class='const'>PDF</span><span class='op'>::</span><span class='const'>Reader</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_pdf'>pdf</span><span class='period'>.</span><span class='id identifier rubyid_absolute_path'>absolute_path</span><span class='lparen'>(</span><span class='id identifier rubyid_dir_files'>dir_files</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='kw'>nil</span>
        <span class='id identifier rubyid_info'>info</span><span class='op'>=</span><span class='id identifier rubyid_reader'>reader</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span>
        <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span>
        <span class='kw'>elsif</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:Subject</span><span class='rbracket'>]</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_find_doi'>find_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:Subject</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_primera_pagina'>primera_pagina</span><span class='op'>=</span><span class='id identifier rubyid_reader'>reader</span><span class='period'>.</span><span class='id identifier rubyid_pages'>pages</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
          <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_find_doi'>find_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_primera_pagina'>primera_pagina</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='op'>&gt;</span><span class='int'>0</span>
            <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
              <span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_pdf'>pdf</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Agregado file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pdf'>pdf</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> a canónico </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cd'>cd</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No puedo encontrar doi: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_doi'>doi</span><span class='embexpr_end'>}</span><span class='tstring_content'> en los canonicos</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:warning</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No puedo encontrar doi en el documento </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pdf'>pdf</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:warning</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

      <span class='kw'>rescue</span> <span class='const'>Exception</span><span class='op'>=&gt;</span><span class='id identifier rubyid_e'>e</span>
        <span class='gvar'>$log</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error on file: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pdf'>pdf</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error on file: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pdf'>pdf</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
        <span class='comment'>#raise
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___group__group_id_delete_-instance_route">
  
    #<strong>GET &#39;/group/:group_id/delete&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>modify to use POST or DELETE method</p>
</div>
  </div>


<p>Deletes a group</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/groups.rb', line 92</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/group/:group_id/delete</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group_id'>group_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@group</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_group_id'>group_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='int'>404</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='ivar'>@group</span>
  <span class='id identifier rubyid_group_name'>group_name</span><span class='op'>=</span><span class='ivar'>@group</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>
  <span class='const'><span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_group_id'>group_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Group_deleted</span><span class='comma'>,</span> <span class='label'>group_name:</span><span class='id identifier rubyid_group_name'>group_name</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___group__id_datos_json_-instance_route">
  
    #<strong>GET &#39;/group/:id/datos.json&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a json with information for a group</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/groups.rb', line 46</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/group/:id/datos.json</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>json</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@group</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>
  <span class='lbrace'>{</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
  <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='ivar'>@group</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
  <span class='symbol'>:group_administrator</span><span class='op'>=&gt;</span><span class='ivar'>@group</span><span class='period'>.</span><span class='id identifier rubyid_group_administrator'>group_administrator</span><span class='comma'>,</span>
   <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='ivar'>@group</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span>
   <span class='symbol'>:users</span><span class='op'>=&gt;</span><span class='ivar'>@group</span><span class='period'>.</span><span class='id identifier rubyid_users_dataset'>users_dataset</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='lbrace'>{</span><span class='label'>id:</span><span class='id identifier rubyid_u'>u</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>name:</span><span class='id identifier rubyid_u'>u</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___group_new_-instance_route">
  
    #<strong>GET &#39;/group/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Display form to create a new group</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30
31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/groups.rb', line 28</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/group/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@group</span><span class='op'>=</span><span class='lbrace'>{</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NA</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:group_administrator</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='rbrace'>}</span>
  <span class='ivar'>@users_id</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:groups/edit</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___my_messages_-instance_route">
  
    #<strong>GET &#39;/my_messages&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 57</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/my_messages</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/user/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/messages</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___record__id_-instance_route">
  
    #<strong>GET &#39;/record/:id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/records.rb', line 8</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/record/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>record_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@reg</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Record.html" title="Record (class)">Record</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='ivar'>@references</span><span class='op'>=</span><span class='ivar'>@reg</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>record</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___record__id_assign_doi__doi_-instance_route">
  
    #<strong>GET &#39;/record/:id/assign_doi/:doi&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/records.rb', line 26</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/record/:id/assign_doi/:doi</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='id identifier rubyid_doi'>doi</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>record_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='ivar'>@reg</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Record.html" title="Record (class)">Record</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>***</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='ivar'>@reg</span><span class='period'>.</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___record__id_search_crossref_-instance_route">
  
    #<strong>GET &#39;/record/:id/search_crossref&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/records.rb', line 16</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/record/:id/search_crossref</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>record_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@reg</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Record.html" title="Record (class)">Record</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='ivar'>@respuesta</span><span class='op'>=</span><span class='ivar'>@reg</span><span class='period'>.</span><span class='id identifier rubyid_crossref_query'>crossref_query</span>
  <span class='comment'># #$log.info(@respuesta)
</span>  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/record_search_crossref</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___reference__id_-instance_route">
  
    #<strong>GET &#39;/reference/:id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/references.rb', line 12</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/reference/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@ref</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='ivar'>@records</span><span class='op'>=</span><span class='ivar'>@ref</span><span class='period'>.</span><span class='id identifier rubyid_records'>records</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:reference</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___reference__id_assign_doi__doi_-instance_route">
  
    #<strong>GET &#39;/reference/:id/assign_doi/:doi&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/references.rb', line 86</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/reference/:id/assign_doi/:doi</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='id identifier rubyid_doi'>doi</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_url'>url</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>volver_url</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@ref</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>***</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='ivar'>@ref</span><span class='period'>.</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_url'>url</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_to'>to</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___reference__id_search_crossref_-instance_route">
  
    #<strong>GET &#39;/reference/:id/search_crossref&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/references.rb', line 64</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/reference/:id/search_crossref</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@ref</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='ivar'>@ref</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span>
    <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='ivar'>@ref</span><span class='period'>.</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='ivar'>@ref</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
    <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>
  <span class='ivar'>@respuesta</span><span class='op'>=</span><span class='ivar'>@ref</span><span class='period'>.</span><span class='id identifier rubyid_crossref_query'>crossref_query</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/reference_search_crossref</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___reference__id_search_similar_-instance_route">
  
    #<strong>GET &#39;/reference/:id/search_similar&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/references.rb', line 20</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/reference/:id/search_similar</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@ref</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='ivar'>@ajax</span><span class='op'>=</span><span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ajax</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@distancia</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>distancia</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@distancia</span><span class='op'>=</span><span class='int'>30</span> <span class='kw'>if</span> <span class='ivar'>@distancia</span><span class='op'>==</span><span class='int'>0</span>
  <span class='ivar'>@ref_similares</span><span class='op'>=</span><span class='ivar'>@ref</span><span class='period'>.</span><span class='id identifier rubyid_search_similars'>search_similars</span><span class='lparen'>(</span><span class='ivar'>@distancia</span><span class='rparen'>)</span>
  <span class='comment'>##$log.info(@ref_similares)
</span>  <span class='kw'>if</span> <span class='ivar'>@ajax</span>
    <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/reference_search_similar</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='symbol'>:layout</span><span class='op'>=&gt;</span><span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/reference_search_similar</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___references_search_crossref_by_doi__doi_-instance_route">
  
    #<strong>GET &#39;/references/search_crossref_by_doi/:doi&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/references.rb', line 52</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/references/search_crossref_by_doi/:doi</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doi'>doi</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>***</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_doi'>doi</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_administration__stage_-instance_route">
  
    #<strong>GET &#39;/review/:id/administration/:stage&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Interface to administrate a stage</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 24</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/administration/:stage</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>


  <span class='ivar'>@stage</span><span class='op'>=</span><span class='id identifier rubyid_stage'>stage</span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='ivar'>@cd_without_allocation</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_without_allocations'>cd_without_allocations</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>

  <span class='ivar'>@cds_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_by_stage'>cd_id_by_stage</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='ivar'>@cds</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@cds_id</span><span class='rparen'>)</span>
  <span class='ivar'>@files_by_cd</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_files_by_cd'>files_by_cd</span>
  <span class='comment'>## Aquí calcularé cuantos si y no hay por categoría
</span>  <span class='id identifier rubyid_res_stage'>res_stage</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_resolution_by_cd'>resolution_by_cd</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@categorizador</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CategorizerSr.html" title="CategorizerSr (class)">CategorizerSr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="CategorizerSr.html#initialize-instance_method" title="CategorizerSr#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>==</span><span class='symbol'>:search</span>
    <span class='ivar'>@aprobacion_categorias</span><span class='op'>=</span><span class='ivar'>@categorizador</span><span class='period'>.</span><span class='id identifier rubyid_categorias_cd_id'>categorias_cd_id</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ac'>ac</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='id identifier rubyid_cd_validos'>cd_validos</span><span class='op'>=</span><span class='id identifier rubyid_res_stage'>res_stage</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_n'>n</span><span class='op'>=</span><span class='id identifier rubyid_cd_validos'>cd_validos</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span><span class='op'>==</span><span class='int'>0</span>
        <span class='id identifier rubyid_ac'>ac</span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>n:</span><span class='int'>0</span><span class='comma'>,</span> <span class='label'>p:</span><span class='kw'>nil</span><span class='rbrace'>}</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_ac'>ac</span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>n:</span><span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='label'>p:</span> <span class='id identifier rubyid_cd_validos'>cd_validos</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_vv'>vv</span><span class='op'>|</span>  <span class='id identifier rubyid_res_stage'>res_stage</span><span class='lbracket'>[</span><span class='id identifier rubyid_vv'>vv</span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>yes</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>/</span>   <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rbrace'>}</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_ac'>ac</span>
    <span class='rbrace'>}</span>
  <span class='kw'>rescue</span> <span class='const'>LoadError</span>
    <span class='ivar'>@categorizador</span><span class='op'>=</span><span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='comment'>#  $log.info(p_aprobaciones_categoria)
</span>  <span class='ivar'>@name_stage</span><span class='op'>=</span><span class='id identifier rubyid_get_stage_name'>get_stage_name</span><span class='lparen'>(</span><span class='ivar'>@stage</span><span class='rparen'>)</span>

  <span class='ivar'>@user_id</span><span class='op'>=</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@modal_files</span><span class='op'>=</span><span class='id identifier rubyid_get_modal_files'>get_modal_files</span>

  <span class='kw'>if</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>screening_title_abstract</span><span class='words_sep'> </span><span class='tstring_content'>screening_references</span><span class='words_sep'> </span><span class='tstring_content'>review_full_text</span><span class='words_sep'>}</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_stage'>stage</span>
    <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/administration_reviews</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/administration_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stage'>stage</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_administration_stages_-instance_route">
  
    #<strong>GET &#39;/review/:id/administration_stages&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>List of administration interfaces by stage</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16
17
18
19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 14</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/administration_stages</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/administration_stages</span><span class='tstring_end'>}</span></span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_advance_stage_-instance_route">
  
    #<strong>GET &#39;/review/:id/advance_stage&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 287</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/advance_stage</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_stage_complete?'>stage_complete?</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stage_i'>stage_i</span><span class='op'>=</span><span class='id identifier rubyid_get_stages_ids'>get_stages_ids</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='lbracket'>[</span><span class='symbol'>:stage</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
    <span class='comment'>#$log.info(stage_i)
</span>    <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='id identifier rubyid_stage_i'>stage_i</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_get_stages_ids'>get_stages_ids</span><span class='lbracket'>[</span><span class='id identifier rubyid_stage_i'>stage_i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:stage_complete</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@review</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/administration/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@review</span><span class='lbracket'>[</span><span class='symbol'>:stage</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:stage_not_yet_complete</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_canonical_documents_-instance_route">
  
    #<strong>GET &#39;/review/:id/canonical_documents&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>DOCUMENTOS CANONICOS #####</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 116</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/canonical_documents</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@pager</span><span class='op'>=</span><span class='id identifier rubyid_get_pager'>get_pager</span>

  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='op'>||=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>n_total_references_in__desc</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@wo_abstract</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>wo_abstract</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@only_records</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>only_records</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span>

  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='ivar'>@cd_total_ds</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span>

  <span class='comment'># Repetidos doi
</span>  <span class='ivar'>@cd_rep_doi</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_doi_repetidos'>doi_repetidos</span>
  <span class='comment'>##$log.info(@cd_rep_doi)
</span>
  <span class='ivar'>@url</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/canonical_documents</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span><span class='period'>.</span><span class='id identifier rubyid_left_join'>left_join</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_count_references_bw_canonical'>count_references_bw_canonical</span><span class='comma'>,</span> <span class='label'>cd_id:</span> <span class='const'>Sequel</span><span class='lbracket'>[</span><span class='symbol'>:canonical_documents</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_left_join'>left_join</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_count_references_rtr'>count_references_rtr</span><span class='comma'>,</span> <span class='label'>cd_end:</span> <span class='symbol'>:cd_id</span><span class='rparen'>)</span>



  <span class='kw'>if</span> <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span>
    <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_ilike'>ilike</span><span class='lparen'>(</span><span class='symbol'>:title</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%</span><span class='embexpr_beg'>#{</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='embexpr_end'>}</span><span class='tstring_content'>%</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@wo_abstract</span>
    <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:abstract</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@only_records</span>
    <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_reg_id'>cd_reg_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>



  <span class='ivar'>@cds_total</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>


  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_max_page'>max_page</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@cds_total</span><span class='op'>/</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_cpp'>cpp</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ceil'>ceil</span>

<span class='comment'>#  $log.info(@pager)
</span>

  <span class='ivar'>@order_criteria</span><span class='op'>=</span><span class='lbrace'>{</span><span class='symbol'>:n_references_rtr</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:RTA_references</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:n_total_references_in</span><span class='op'>=&gt;</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Citations</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:n_total_references_made</span><span class='op'>=&gt;</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Outgoing_citations</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Title</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:year</span><span class='op'>=&gt;</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Year</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:author</span><span class='op'>=&gt;</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Author</span><span class='rparen'>)</span><span class='rbrace'>}</span>


  <span class='ivar'>@cds</span><span class='op'>=</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_adjust_query'>adjust_query</span><span class='lparen'>(</span><span class='ivar'>@cds_pre</span><span class='rparen'>)</span>

  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>


  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/canonical_documents</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_canonical_documents_graphml_-instance_route">
  
    #<strong>GET &#39;/review/:id/canonical_documents_graphml&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


187
188
189
190
191
192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 187</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/canonical_documents_graphml</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attachment;filename=graphml_revision_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>.graphml</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/graphml+xml</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_graphml'>graphml</span><span class='op'>=</span><span class='const'>GraphML_Builder</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_graphml'>graphml</span><span class='period'>.</span><span class='id identifier rubyid_generate_graphml'>generate_graphml</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_files_-instance_route">
  
    #<strong>GET &#39;/review/:id/files&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252
253
254
255
256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 246</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/files</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@file_rs</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="IFile.html" title="IFile (class)">IFile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='symbol'>:file_srs</span><span class='comma'>,</span> <span class='symbol'>:file_id</span> <span class='op'>=&gt;</span> <span class='symbol'>:id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_left_join'>left_join</span><span class='lparen'>(</span><span class='symbol'>:file_cds</span><span class='comma'>,</span> <span class='symbol'>:file_id</span> <span class='op'>=&gt;</span> <span class='symbol'>:file_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order_by'>order_by</span><span class='lparen'>(</span><span class='symbol'>:filename</span><span class='rparen'>)</span>
  <span class='ivar'>@modal_files</span><span class='op'>=</span><span class='id identifier rubyid_get_modal_files'>get_modal_files</span>

  <span class='ivar'>@canonical_documents_h</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:title</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_as_hash'>as_hash</span>
  <span class='ivar'>@cd_validos_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_by_stage'>cd_id_by_stage</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='ivar'>@cd_validos</span><span class='op'>=</span><span class='ivar'>@canonical_documents_h</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='ivar'>@cd_validos_id</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/files</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_messages_-instance_route">
  
    #<strong>GET &#39;/review/:id/messages&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222
223
224
225
226
227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 220</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/messages</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@mensajes_rs</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_message_srs_dataset'>message_srs_dataset</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_desc'>desc</span><span class='lparen'>(</span><span class='symbol'>:time</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='comment'>#@mensajes_rs_vistos=MessageSrSeen.where(:read=&gt;true,:m_rs_id=&gt;@mensajes_rs.select_map(:id), :user_id=&gt;session[&#39;user_id&#39;]).select_map(:m_rs_id)
</span>  <span class='comment'>#$log.info(@mensajes_rs_vistos)
</span>  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/messages</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_repeated_canonical_documents_-instance_route">
  
    #<strong>GET &#39;/review/:id/repeated_canonical_documents&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 173</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/repeated_canonical_documents</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@cd_rep_doi</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_doi_repetidos'>doi_repetidos</span>
  <span class='ivar'>@cd_hash</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span><span class='period'>.</span><span class='id identifier rubyid_as_hash'>as_hash</span>

  <span class='ivar'>@cd_por_doi</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span> <span class='op'>=&gt;</span> <span class='ivar'>@cd_rep_doi</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_hash_groups'>to_hash_groups</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='comment'>##$log.info(@cd_por_doi)
</span>  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/repeated_canonical_documents</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_review_full_text_-instance_route">
  
    #<strong>GET &#39;/review/:id/review_full_text&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/stages.rb', line 116</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/review_full_text</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>


  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='ivar'>@user_id</span><span class='op'>=</span><span class='ivar'>@usuario</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span>


  <span class='ivar'>@pager</span><span class='op'>=</span><span class='id identifier rubyid_get_pager'>get_pager</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='op'>||=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>year__asc</span><span class='tstring_end'>&quot;</span></span>


  <span class='ivar'>@order_criteria</span><span class='op'>=</span><span class='lbrace'>{</span><span class='symbol'>:n_references_rtr</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:RTA_references</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Title</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:year</span><span class='op'>=&gt;</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Year</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:author</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Author</span><span class='rparen'>)</span><span class='rbrace'>}</span>

  <span class='comment'># $log.info(params)
</span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='ivar'>@cd_total_ds</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span>


  <span class='ivar'>@url</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/review_full_text</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@ads</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisUserDecision.html" title="AnalysisUserDecision (class)">AnalysisUserDecision</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisUserDecision.html#initialize-instance_method" title="AnalysisUserDecision#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@user_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_full_text</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span><span class='period'>.</span><span class='id identifier rubyid_join_table'>join_table</span><span class='lparen'>(</span><span class='symbol'>:left</span><span class='comma'>,</span> <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_count_references_rtr_tn'>count_references_rtr_tn</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='label'>cd_end:</span> <span class='symbol'>:id</span><span class='rparen'>)</span>

  <span class='ivar'>@asignaciones</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_asignaciones'>asignaciones</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='rparen'>)</span>

  <span class='ivar'>@decisions</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_decisions'>decisions</span>
  <span class='ivar'>@cds_total</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>

  <span class='kw'>if</span> <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_cd_ids'>cd_ids</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_decision_por_cd'>decision_por_cd</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='op'>==</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
    <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cd_ids'>cd_ids</span><span class='rparen'>)</span>
  <span class='kw'>end</span>




  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_max_page'>max_page</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='op'>/</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_cpp'>cpp</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ceil'>ceil</span>

  <span class='ivar'>@cds</span><span class='op'>=</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_adjust_query'>adjust_query</span><span class='lparen'>(</span><span class='ivar'>@cds_pre</span><span class='rparen'>)</span>


  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/review_full_text</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_screening_references_-instance_route">
  
    #<strong>GET &#39;/review/:id/screening_references&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/stages.rb', line 62</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/screening_references</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='ivar'>@user_id</span><span class='op'>=</span><span class='ivar'>@usuario</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span>


  <span class='ivar'>@pager</span><span class='op'>=</span><span class='id identifier rubyid_get_pager'>get_pager</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='op'>||=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>n_references_rtr__desc</span><span class='tstring_end'>&quot;</span></span>


  <span class='ivar'>@order_criteria</span><span class='op'>=</span><span class='lbrace'>{</span><span class='symbol'>:n_references_rtr</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:RTA_references</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Title</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:year</span><span class='op'>=&gt;</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Year</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:author</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Author</span><span class='rparen'>)</span><span class='rbrace'>}</span>

  <span class='comment'># $log.info(params)
</span>  <span class='ivar'>@stage</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>screening_references</span><span class='tstring_end'>&#39;</span></span>


  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='ivar'>@cd_total_ds</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span>


  <span class='ivar'>@url</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/screening_references</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@ads</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisUserDecision.html" title="AnalysisUserDecision (class)">AnalysisUserDecision</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisUserDecision.html#initialize-instance_method" title="AnalysisUserDecision#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@user_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>screening_references</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span><span class='period'>.</span><span class='id identifier rubyid_join_table'>join_table</span><span class='lparen'>(</span><span class='symbol'>:inner</span><span class='comma'>,</span> <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_count_references_rtr_tn'>count_references_rtr_tn</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='label'>cd_end:</span> <span class='symbol'>:id</span><span class='rparen'>)</span>


  <span class='ivar'>@decisions</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_decisions'>decisions</span>
  <span class='ivar'>@cds_total</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>

  <span class='kw'>if</span> <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_cd_ids'>cd_ids</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_decision_por_cd'>decision_por_cd</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='op'>==</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
    <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cd_ids'>cd_ids</span><span class='rparen'>)</span>
  <span class='kw'>end</span>




  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_max_page'>max_page</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='op'>/</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_cpp'>cpp</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ceil'>ceil</span>

  <span class='ivar'>@cds</span><span class='op'>=</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_adjust_query'>adjust_query</span><span class='lparen'>(</span><span class='ivar'>@cds_pre</span><span class='rparen'>)</span>


  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/screening_general</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_screening_title_abstract_-instance_route">
  
    #<strong>GET &#39;/review/:id/screening_title_abstract&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/stages.rb', line 8</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/screening_title_abstract</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='ivar'>@user_id</span><span class='op'>=</span><span class='ivar'>@usuario</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span>


  <span class='ivar'>@pager</span><span class='op'>=</span><span class='id identifier rubyid_get_pager'>get_pager</span>
  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='op'>||=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>year__asc</span><span class='tstring_end'>&quot;</span></span>


  <span class='ivar'>@order_criteria</span><span class='op'>=</span><span class='lbrace'>{</span><span class='symbol'>:title</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Title</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:year</span><span class='op'>=&gt;</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Year</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:author</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Author</span><span class='rparen'>)</span><span class='rbrace'>}</span>

  <span class='comment'># $log.info(params)
</span>

  <span class='ivar'>@stage</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>screening_title_abstract</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='ivar'>@cd_total_ds</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span>


  <span class='ivar'>@url</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@stage</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@ads</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisUserDecision.html" title="AnalysisUserDecision (class)">AnalysisUserDecision</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisUserDecision.html#initialize-instance_method" title="AnalysisUserDecision#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@user_id</span><span class='comma'>,</span><span class='ivar'>@stage</span><span class='rparen'>)</span>

  <span class='gvar'>$log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='ivar'>@ads</span><span class='rparen'>)</span>
 <span class='comment'># $log.info(&quot;HOAL&quot;)
</span>
  <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_canonical_documents'>canonical_documents</span>
  <span class='ivar'>@cds_total</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>

  <span class='ivar'>@decisions</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_decisions'>decisions</span>
  <span class='kw'>if</span> <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_cd_ids'>cd_ids</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_decision_por_cd'>decision_por_cd</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='op'>==</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
    <span class='ivar'>@cds_pre</span><span class='op'>=</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cd_ids'>cd_ids</span><span class='rparen'>)</span>
  <span class='kw'>end</span>




  <span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_max_page'>max_page</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@cds_pre</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='op'>/</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_cpp'>cpp</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ceil'>ceil</span>

  <span class='ivar'>@cds</span><span class='op'>=</span><span class='ivar'>@pager</span><span class='period'>.</span><span class='id identifier rubyid_adjust_query'>adjust_query</span><span class='lparen'>(</span><span class='ivar'>@cds_pre</span><span class='rparen'>)</span>


  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/screening_general</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_search_new_-instance_route">
  
    #<strong>GET &#39;/review/:id/search/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Form to create a new search</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/searches.rb', line 30</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/search/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date</span><span class='tstring_end'>&#39;</span></span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@header</span><span class='op'>=</span><span class='id identifier rubyid_t_systematic_review_title'>t_systematic_review_title</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:New_search</span><span class='rparen'>)</span>
  <span class='ivar'>@bb_general_id</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="BibliographicDatabase.html" title="BibliographicDatabase (class)">BibliographicDatabase</a></span></span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>generic</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span>
  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:source</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>database_search</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:valid</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='comma'>,</span> <span class='symbol'>:date_creation</span><span class='op'>=&gt;</span><span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='comma'>,</span> <span class='symbol'>:bibliographic_database_id</span><span class='op'>=&gt;</span><span class='ivar'>@bb_general_id</span><span class='rparen'>)</span>
  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>searches/search_edit</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_searches_-instance_route">
  
    #<strong>GET &#39;/review/:id/searches&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>List of searches</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/searches.rb', line 12</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/searches</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@searches</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_searches'>searches</span>
  <span class='ivar'>@header</span><span class='op'>=</span><span class='id identifier rubyid_t_systematic_review_title'>t_systematic_review_title</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:systematic_review_searches</span><span class='rparen'>)</span>
  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>

  <span class='gvar'>$log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='ivar'>@user</span><span class='rparen'>)</span>

  <span class='ivar'>@url_back</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/searches</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/searches</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_stage__stage_pattern__patron_resolution__resolution_-instance_route">
  
    #<strong>GET &#39;/review/:id/stage/:stage/pattern/:patron/resolution/:resolution&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set a resolution for a given pattern</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 70</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/stage/:stage/pattern/:patron/resolution/:resolution</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span><span class='id identifier rubyid_patron_s'>patron_s</span><span class='comma'>,</span><span class='id identifier rubyid_resolution'>resolution</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patron'>patron</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_pattern_from_s'>pattern_from_s</span><span class='lparen'>(</span><span class='id identifier rubyid_patron_s'>patron_s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cds'>cds</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_from_pattern'>cd_from_pattern</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='id identifier rubyid_patron'>patron</span><span class='rparen'>)</span>

  <span class='gvar'>$log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='id identifier rubyid_cds'>cds</span><span class='rparen'>)</span>

  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_cds'>cds</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='op'>|</span>
      <span class='id identifier rubyid_res'>res</span><span class='op'>=</span><span class='const'>Resolution</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='const'><span class='object_link'><a href="Resolution.html" title="Resolution (class)">Resolution</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='symbol'>:resolution</span><span class='op'>=&gt;</span><span class='id identifier rubyid_resolution'>resolution</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:commentary</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Resuelto en forma masiva en </span><span class='embexpr_beg'>#{</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:resolution</span><span class='op'>=&gt;</span><span class='id identifier rubyid_resolution'>resolution</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:commentary</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Actualizado en forma masiva en </span><span class='embexpr_beg'>#{</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resolution_for_n_documents</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>resolution:</span><span class='id identifier rubyid_resolution'>resolution</span><span class='comma'>,</span> <span class='label'>n:</span><span class='id identifier rubyid_cds'>cds</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__id_tags_-instance_route">
  
    #<strong>GET &#39;/review/:id/tags&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 201</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/tags</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@stages_list</span><span class='op'>=</span><span class='lbrace'>{</span><span class='symbol'>:NIL</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--Todas--</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_get_stages_names_t'>get_stages_names_t</span><span class='rparen'>)</span>

  <span class='ivar'>@select_stage</span><span class='op'>=</span><span class='id identifier rubyid_get_xeditable_select'>get_xeditable_select</span><span class='lparen'>(</span><span class='ivar'>@stages_list</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tags/classes/edit_field/stage</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select_stage</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@select_stage</span><span class='period'>.</span><span class='id identifier rubyid_nil_value'>nil_value</span><span class='op'>=</span><span class='symbol'>:NIL</span>
  <span class='ivar'>@types_list</span><span class='op'>=</span><span class='lbrace'>{</span><span class='label'>general:</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>General</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>document:</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Documento</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>relation:</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Relación</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>

  <span class='ivar'>@select_type</span><span class='op'>=</span><span class='id identifier rubyid_get_xeditable_select'>get_xeditable_select</span><span class='lparen'>(</span><span class='ivar'>@types_list</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tags/classes/edit_field/type</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select_type</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@tag_estadisticas</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_tags_estadisticas'>tags_estadisticas</span>


  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/tags</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_administration__stage_cd_assignations_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/administration/:stage/cd_assignations&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>List of allocations of canonical documents to users</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 147</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/administration/:stage/cd_assignations</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@cds_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_by_stage'>cd_id_by_stage</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='ivar'>@stage</span><span class='op'>=</span><span class='id identifier rubyid_stage'>stage</span>
  <span class='ivar'>@cds</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@cds_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:author</span><span class='rparen'>)</span>
  <span class='ivar'>@type</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>all</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_haml'>haml</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/cd_assignations_to_user</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_administration__stage_cd_without_allocations_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/administration/:stage/cd_without_allocations&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167
168
169
170
171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 164</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/administration/:stage/cd_without_allocations</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>

  <span class='ivar'>@stage</span><span class='op'>=</span><span class='id identifier rubyid_stage'>stage</span>
  <span class='ivar'>@cds</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_without_allocations'>cd_without_allocations</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:author</span><span class='rparen'>)</span>
  <span class='ivar'>@type</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>without_allocation</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_haml'>haml</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/cd_assignations_to_user</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_add_assign_user__user_id__type_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/add_assign_user/:user_id/:type&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Allocate canonical documents to a user if type=&#39;all&#39;, all documents
are allocated if type=&#39;without_allocation&#39;, only documents without
allocation are allocated</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183
184
185
186
187
188
189
190
191
192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 181</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/add_assign_user/:user_id/:type</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span><span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_type'>type</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all</span><span class='tstring_end'>&#39;</span></span>
    <span class='ivar'>@cds_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_by_stage'>cd_id_by_stage</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_type'>type</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>without_allocation</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_ars'>ars</span><span class='op'>=</span><span class='const'>AnalysisSystematicReview</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
    <span class='ivar'>@cds_id_previous</span><span class='op'>=</span><span class='id identifier rubyid_ars'>ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_assigned_by_user'>cd_id_assigned_by_user</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='ivar'>@cds_id_add</span><span class='op'>=</span><span class='id identifier rubyid_ars'>ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_without_allocations'>cd_without_allocations</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
    <span class='ivar'>@cds_id</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@cds_id_previous</span><span class='op'>+</span><span class='ivar'>@cds_id_add</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="AllocationCd.html" title="AllocationCd (class)">AllocationCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_update_assignation'><span class='object_link'><a href="AllocationCd.html#update_assignation-class_method" title="AllocationCd.update_assignation (method)">update_assignation</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='ivar'>@cds_id</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>massive_assigment</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_complete_empty_abstract_manual_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/complete_empty_abstract_manual&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>List of documents without abstract</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 210</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/complete_empty_abstract_manual</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='ivar'>@stage</span><span class='op'>=</span><span class='id identifier rubyid_stage'>stage</span>
  <span class='ivar'>@cd_wo_abstract</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_without_abstract'>cd_without_abstract</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/complete_abstract_manual</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_complete_empty_abstract_scopus_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/complete_empty_abstract_scopus&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Automatic retrieval of abstract from Scopus for documents without abstract</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


223
224
225
226
227
228
229
230
231
232
233
234
235
236</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 223</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/complete_empty_abstract_scopus</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@cd_wo_abstract</span><span class='op'>=</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_cd_without_abstract'>cd_without_abstract</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Processing_n_canonical_documents</span><span class='comma'>,</span> <span class='label'>count:</span><span class='ivar'>@cd_wo_abstract</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='ivar'>@cd_wo_abstract</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cd'>cd</span><span class='op'>|</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Scopus_Abstract.html" title="Scopus_Abstract (class)">Scopus_Abstract</a></span></span><span class='period'>.</span><span class='id identifier rubyid_obtener_abstract_cd'><span class='object_link'><a href="Scopus_Abstract.html#obtener_abstract_cd-class_method" title="Scopus_Abstract.obtener_abstract_cd (method)">obtener_abstract_cd</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_generar_references_crossref_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/generar_references_crossref&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieve information from Crossref for all canonical documents approved for
a given stage</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 101</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/generar_references_crossref</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span><span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_dois_agregados'>dois_agregados</span><span class='op'>=</span><span class='int'>0</span>
  <span class='id identifier rubyid_cd_i'>cd_i</span><span class='op'>=</span><span class='const'>Resolution</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='symbol'>:resolution</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>yes</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span> <span class='lbracket'>[</span><span class='symbol'>:canonical_document_id</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_cd_i'>cd_i</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='op'>|</span>
    <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rbracket'>]</span>

    <span class='comment'># first, we process all records pertinent with this canonical document.
</span>    <span class='id identifier rubyid_records'>records</span><span class='op'>=</span><span class='const'>Record</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rcp'>rcp</span><span class='op'>=</span><span class='const'>RecordCrossrefProcessor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_records'>records</span><span class='comma'>,</span><span class='gvar'>$db</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_rcp'>rcp</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_crossref_integrator'>crossref_integrator</span>
      <span class='kw'>begin</span>
        <span class='comment'># Agregar dois a references
</span>        <span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_references_performed'>references_performed</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span>
          <span class='comment'># primero agregamos doi si podemos
</span>          <span class='comment'># Si tiene doi, tratamos de
</span>          <span class='id identifier rubyid_rp'>rp</span><span class='op'>=</span><span class='const'>ReferenceProcessor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='id identifier rubyid_dois_agregados'>dois_agregados</span><span class='op'>+=</span><span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_rp'>rp</span><span class='period'>.</span><span class='id identifier rubyid_process_doi'>process_doi</span>
          <span class='kw'>end</span>

          <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span><span class='op'>=&gt;</span><span class='id identifier rubyid_e'>e</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error.error_on_add_crossref_for_cd</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>cd_title:</span><span class='ivar'>@cd</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Search_add_doi_references</span><span class='comma'>,</span> <span class='symbol'>:count</span><span class='op'>=&gt;</span><span class='id identifier rubyid_dois_agregados'>dois_agregados</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_generate_bibtex_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/generate_bibtex&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a BibTeX file of documents on a specific stage</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/export.rb', line 29</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/generate_bibtex</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='id identifier rubyid_canonicos_id'>canonicos_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_by_stage'>cd_id_by_stage</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='ivar'>@canonicos_resueltos</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_canonicos_id'>canonicos_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:author</span><span class='comma'>,</span><span class='symbol'>:year</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_bib'>bib</span><span class='op'>=</span><span class='const'>ReferenceIntegrator</span><span class='op'>::</span><span class='const'>BibTex</span><span class='op'>::</span><span class='const'>Writer</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='ivar'>@canonicos_resueltos</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attachment;filename=systematic_review_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stage'>stage</span><span class='embexpr_end'>}</span><span class='tstring_content'>.bib</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/x-bibtex</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_bib'>bib</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_generate_doi_list_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/generate_doi_list&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a list of DOI of documents on a specific stage</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/export.rb', line 46</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/generate_doi_list</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='id identifier rubyid_canonicos_id'>canonicos_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_by_stage'>cd_id_by_stage</span><span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='ivar'>@canonicos_resueltos</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_canonicos_id'>canonicos_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:author</span><span class='comma'>,</span><span class='symbol'>:year</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_exclude'>exclude</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dois'>dois</span><span class='op'>=</span><span class='ivar'>@canonicos_resueltos</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_doi'>doi</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'>#  headers[&quot;Content-Disposition&quot;] = &quot;attachment;filename=systematic_review_#{rev_id}_#{stage}.bib&quot;
</span>  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_dois'>dois</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_generate_graphml_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/generate_graphml&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a GraphML file of documents on a specific stage.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://graphml.graphdrawing.org/" target="_parent" title="GraphML website">GraphML website</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18
19
20
21
22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/export.rb', line 15</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/generate_graphml</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attachment;filename=graphml_review_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>_stage_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stage'>stage</span><span class='embexpr_end'>}</span><span class='tstring_content'>.graphml</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/graphml+xml</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_graphml'>graphml</span><span class='op'>=</span><span class='const'>GraphML_Builder</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_graphml'>graphml</span><span class='period'>.</span><span class='id identifier rubyid_generate_graphml'>generate_graphml</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rev_id_stage__stage_rem_assign_user__user_id__type_-instance_route">
  
    #<strong>GET &#39;/review/:rev_id/stage/:stage/rem_assign_user/:user_id/:type&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove all documents allocations from a user</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202
203
204
205
206</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/administration.rb', line 199</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rev_id/stage/:stage/rem_assign_user/:user_id/:type</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='comment'># Type doesn&#39;t have meaning here
</span>  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rev_id'>rev_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="AllocationCd.html" title="AllocationCd (class)">AllocationCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_update_assignation'><span class='object_link'><a href="AllocationCd.html#update_assignation-class_method" title="AllocationCd.update_assignation (method)">update_assignation</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rs_id_field__fid_delete_-instance_route">
  
    #<strong>GET &#39;/review/:rs_id/field/:fid/delete&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Delete a field</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


66
67
68
69
70
71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/fields.rb', line 66</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rs_id/field/:fid/delete</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>  <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span> <span class='id identifier rubyid_fid'>fid</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sr_field'>sr_field</span><span class='op'>=</span><span class='const'>SrField</span><span class='lbracket'>[</span><span class='id identifier rubyid_fid'>fid</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_name'>name</span><span class='op'>=</span><span class='id identifier rubyid_sr_field'>sr_field</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_sr_field'>sr_field</span>
  <span class='id identifier rubyid_sr_field'>sr_field</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fields.field_deleted</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>name:</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rs_id_fields_-instance_route">
  
    #<strong>GET &#39;/review/:rs_id/fields&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>List of personalized fields</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15
16
17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/fields.rb', line 13</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rs_id/fields</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@campos</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/fields</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rs_id_searches_compare_records_-instance_route">
  
    #<strong>GET &#39;/review/:rs_id/searches/compare_records&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Compare records betweeen searches</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/searches.rb', line 62</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rs_id/searches/compare_records</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@cds</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@errores</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@searches_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_searches_dataset'>searches_dataset</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n_searches'>n_searches</span><span class='op'>=</span><span class='ivar'>@searches_id</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_searches'>searches</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_search'>search</span><span class='op'>|</span>
    <span class='id identifier rubyid_search'>search</span><span class='period'>.</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_registro'>registro</span><span class='op'>|</span>
      <span class='id identifier rubyid_rcd_id'>rcd_id</span><span class='op'>=</span><span class='id identifier rubyid_registro'>registro</span><span class='lbracket'>[</span><span class='symbol'>:canonical_document_id</span><span class='rbracket'>]</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_rcd_id'>rcd_id</span>
        <span class='ivar'>@cds</span><span class='lbracket'>[</span><span class='id identifier rubyid_rcd_id'>rcd_id</span><span class='rbracket'>]</span><span class='op'>||=</span><span class='lbrace'>{</span><span class='symbol'>:searches</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rbrace'>}</span>
        <span class='ivar'>@cds</span><span class='lbracket'>[</span><span class='id identifier rubyid_rcd_id'>rcd_id</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:searches</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_search'>search</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='op'>=</span><span class='kw'>true</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_errores'>errores</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_registro'>registro</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@cds_o</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@cds</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='ivar'>@cds_ordered</span><span class='op'>=</span><span class='ivar'>@cds</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
    <span class='comment'>#$log.info(@searches_id)
</span>    <span class='comment'>#$log.info(a)
</span>    <span class='id identifier rubyid_base_n'>base_n</span><span class='op'>=</span><span class='int'>1</span><span class='op'>+</span><span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='symbol'>:searches</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>*</span><span class='lparen'>(</span><span class='int'>2</span><span class='op'>**</span><span class='lparen'>(</span><span class='id identifier rubyid_n_searches'>n_searches</span><span class='op'>+</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='comment'>#$log.info(&quot;Base:#{base_n}&quot;)
</span>    <span class='id identifier rubyid_sec_n'>sec_n</span><span class='op'>=</span><span class='lparen'>(</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_n_searches'>n_searches</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_total'>total</span><span class='comma'>,</span><span class='id identifier rubyid_aa'>aa</span><span class='op'>|</span>  <span class='id identifier rubyid_total'>total</span><span class='op'>+=</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='symbol'>:searches</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='ivar'>@searches_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_aa'>aa</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rparen'>)</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='int'>2</span><span class='op'>**</span><span class='id identifier rubyid_aa'>aa</span><span class='semicolon'>;</span><span class='id identifier rubyid_total'>total</span><span class='rbrace'>}</span>
    <span class='comment'>#$log.info(&quot;Sec:#{sec_n}&quot;)
</span>    <span class='id identifier rubyid_base_n'>base_n</span><span class='op'>+</span><span class='id identifier rubyid_sec_n'>sec_n</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>searches/compare_records</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rs_id_searches_user__user_id_-instance_route">
  
    #<strong>GET &#39;/review/:rs_id/searches/user/:user_id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>List of searches for a user</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/searches.rb', line 47</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rs_id/searches/user/:user_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@header</span><span class='op'>=</span><span class='id identifier rubyid_t_systematic_review_title'>t_systematic_review_title</span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:searches_user</span><span class='comma'>,</span> <span class='symbol'>:user_name</span><span class='op'>=&gt;</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='ivar'>@url_back</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/searches/user/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_id'>user_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@searches</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_searches_dataset'>searches_dataset</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/searches</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__rs_id_update_field_table_-instance_route">
  
    #<strong>GET &#39;/review/:rs_id/update_field_table&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update analysis table, using information provide on fields</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/fields.rb', line 55</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rs_id/update_field_table</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@campos</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span>
  <span class='const'><span class='object_link'><a href="SrField.html" title="SrField (class)">SrField</a></span></span><span class='period'>.</span><span class='id identifier rubyid_actualizar_tabla'><span class='object_link'><a href="SrField.html#actualizar_tabla-class_method" title="SrField.actualizar_tabla (method)">actualizar_tabla</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fields.sr_table_update_success</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__sr_id_extract_information_cd__cd_id_-instance_route">
  
    #<strong>GET &#39;/review/:sr_id/extract_information/cd/:cd_id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Form to retrieve information from a document in stage review full text</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/extract_information.rb', line 13</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:sr_id/extract_information/cd/:cd_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='comma'>,</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@sr</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_sr_id'>sr_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@sr</span>


  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='ivar'>@sr</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@stage</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_full_text</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_cds_id'>cds_id</span><span class='op'>=</span><span class='ivar'>@sr</span><span class='period'>.</span><span class='id identifier rubyid_cd_id_by_stage'>cd_id_by_stage</span><span class='lparen'>(</span><span class='ivar'>@stage</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_cds_id'>cds_id</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Canonical_documento_not_assigned_to_this_systematic_review</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_adu'>adu</span><span class='op'>=</span><span class='const'>AnalysisUserDecision</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='comma'>,</span> <span class='ivar'>@user</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_full_text</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_adu'>adu</span><span class='period'>.</span><span class='id identifier rubyid_allocated_to_cd_id'>allocated_to_cd_id</span><span class='lparen'>(</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Canonical_documento_not_assigned_to_this_user</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
  <span class='kw'>end</span>
  <span class='ivar'>@files_id</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:not_consider</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='rparen'>)</span>
  <span class='ivar'>@files</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="IFile.html" title="IFile (class)">IFile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@files_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_as_hash'>as_hash</span>

  <span class='ivar'>@current_file_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@files</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>

  <span class='ivar'>@current_file</span> <span class='op'>=</span> <span class='ivar'>@files</span><span class='lbracket'>[</span><span class='ivar'>@current_file_id</span><span class='rbracket'>]</span>


  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@sr</span><span class='rparen'>)</span>

  <span class='ivar'>@ads</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisUserDecision.html" title="AnalysisUserDecision (class)">AnalysisUserDecision</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisUserDecision.html#initialize-instance_method" title="AnalysisUserDecision#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='comma'>,</span> <span class='ivar'>@user</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@stage</span><span class='rparen'>)</span>

  <span class='ivar'>@decisions</span><span class='op'>=</span><span class='ivar'>@ads</span><span class='period'>.</span><span class='id identifier rubyid_decisions'>decisions</span>

  <span class='ivar'>@form_creator</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="FormBuilder.html" title="FormBuilder (class)">FormBuilder</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="FormBuilder.html#initialize-instance_method" title="FormBuilder#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@sr</span><span class='comma'>,</span> <span class='ivar'>@cd</span><span class='comma'>,</span> <span class='ivar'>@user</span><span class='rparen'>)</span>
  <span class='ivar'>@incoming_citations</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_incoming_citations'>incoming_citations</span><span class='lparen'>(</span><span class='ivar'>@stage</span><span class='comma'>,</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:year</span><span class='comma'>,</span><span class='symbol'>:author</span><span class='rparen'>)</span>
  <span class='ivar'>@outgoing_citations</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@ars</span><span class='period'>.</span><span class='id identifier rubyid_outgoing_citations'>outgoing_citations</span><span class='lparen'>(</span><span class='ivar'>@stage</span><span class='comma'>,</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:year</span><span class='comma'>,</span><span class='symbol'>:author</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>systematic_reviews/cd_extract_information</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review__sr_id_report__type__format_-instance_route">
  
    #<strong>GET &#39;/review/:sr_id/report/:type/:format&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Provide a report</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="ReportBuilder.html#get_report-class_method" title="ReportBuilder.get_report (method)">ReportBuilder.get_report</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15
16
17
18
19
20
21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/reports.rb', line 13</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:sr_id/report/:type/:format</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='comma'>,</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@sr</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_sr_id'>sr_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@sr</span>
  <span class='ivar'>@type</span><span class='op'>=</span><span class='id identifier rubyid_type'>type</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='ivar'>@sr</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@report</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="ReportBuilder.html" title="ReportBuilder (module)">ReportBuilder</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_report'><span class='object_link'><a href="ReportBuilder.html#get_report-class_method" title="ReportBuilder.get_report (method)">get_report</a></span></span><span class='lparen'>(</span><span class='ivar'>@sr</span><span class='comma'>,</span><span class='ivar'>@type</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_format'>format</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/reports/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>else</span>
    <span class='ivar'>@report</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='lparen'>(</span><span class='id identifier rubyid_format'>format</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___review_new_-instance_route">
  
    #<strong>GET &#39;/review/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 31</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_title'>title</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Systematic_review_new</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_first_group'>first_group</span><span class='op'>=</span><span class='const'>User</span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_groups'>groups</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_administrator'>administrator</span><span class='op'>=</span><span class='id identifier rubyid_first_group'>first_group</span><span class='lbracket'>[</span><span class='symbol'>:group_administrator</span><span class='rbracket'>]</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>      <span class='label'>active:</span><span class='kw'>true</span><span class='comma'>,</span>
                                     <span class='label'>stage:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>search</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                     <span class='label'>group:</span><span class='id identifier rubyid_first_group'>first_group</span><span class='comma'>,</span>
                                     <span class='label'>sr_administrator:</span><span class='id identifier rubyid_administrator'>administrator</span><span class='comma'>,</span>
                                     <span class='label'>date_creation:</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span>
                                     <span class='rparen'>)</span>
  <span class='ivar'>@taxonomy_categories_id</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/edit</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___reviews_-instance_route">
  
    #<strong>GET &#39;/reviews&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 10</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/reviews</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='ivar'>@show_inactives</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>show_inactives</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@show_inactives</span><span class='op'>||=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>only_actives</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@show_only_user</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>show_only_user</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@show_only_user</span><span class='op'>||=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>yes</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>if</span> <span class='ivar'>@show_only_user</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>yes</span><span class='tstring_end'>&#39;</span></span>
    <span class='ivar'>@reviewes</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_revisiones_por_usuario'><span class='object_link'><a href="SystematicReview.html#get_revisiones_por_usuario-class_method" title="SystematicReview.get_revisiones_por_usuario (method)">get_revisiones_por_usuario</a></span></span><span class='lparen'>(</span><span class='ivar'>@usuario</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='ivar'>@reviewes</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span>
  <span class='kw'>end</span>


  <span class='ivar'>@reviewes</span><span class='op'>=</span><span class='ivar'>@reviewes</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:active</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@show_inactives</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>only_actives</span><span class='tstring_end'>&#39;</span></span>


  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:reviews</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___role__id_-instance_route">
  
    #<strong>GET &#39;/role/:id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Information about a role</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/roles.rb', line 36</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/role/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_role_id'>role_id</span><span class='op'>|</span>

  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@role</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_role_id'>role_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoRoleIdError.html" title="Buhos::NoRoleIdError (class)">NoRoleIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_role_id'>role_id</span> <span class='kw'>if</span> <span class='ivar'>@role</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@authorizations</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Authorization.html" title="Authorization (class)">Authorization</a></span></span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin/role_view</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___role__role_id_delete_-instance_route">
  
    #<strong>GET &#39;/role/:role_id/delete&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>modify to use POST or DELETE method</p>
</div>
  </div>


<p>Deletes a role</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/roles.rb', line 64</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/role/:role_id/delete</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_role_id'>role_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='int'>403</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_role_id'>role_id</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>administrator</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='id identifier rubyid_role_id'>role_id</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>analyst</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_role_id'>role_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Role_deleted_name</span><span class='comma'>,</span> <span class='label'>role:</span><span class='id identifier rubyid_role_id'>role_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___role__role_id_edit_-instance_route">
  
    #<strong>GET &#39;/role/:role_id/edit&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Form to update a role</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51
52
53
54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/roles.rb', line 48</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/role/:role_id/edit</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_role_id'>role_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:sinatra_auth.nobody_can_edit_these_roles</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>administrator</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>analyst</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_role_id'>role_id</span>


  <span class='ivar'>@role</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_role_id'>role_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@authorizations</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Authorization.html" title="Authorization (class)">Authorization</a></span></span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='ivar'>@role</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin/role_edit</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___role_new_-instance_route">
  
    #<strong>GET &#39;/role/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Form to create a new role</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27
28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/roles.rb', line 21</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/role/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>


  <span class='id identifier rubyid_role_id'>role_id</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Role </span><span class='embexpr_beg'>#{</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unrestrict_primary_key'>unrestrict_primary_key</span>

  <span class='ivar'>@role</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_role_id'>role_id</span><span class='comma'>,</span> <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Description</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@authorizations</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Authorization.html" title="Authorization (class)">Authorization</a></span></span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin/role_edit</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_-instance_route">
  
    #<strong>GET &#39;/search/:id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 8</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_systematic_review'>systematic_review</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:searches/search_view</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_edit_-instance_route">
  
    #<strong>GET &#39;/search/:id/edit&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21
22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 17</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/edit</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_systematic_review'>systematic_review</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:searches/search_edit</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_file_download_-instance_route">
  
    #<strong>GET &#39;/search/:id/file/download&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 26</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/file/download</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>if</span> <span class='ivar'>@search</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='int'>404</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attachment; filename=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@search</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_content_type'>content_type</span> <span class='ivar'>@search</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span>
    <span class='ivar'>@search</span><span class='lbracket'>[</span><span class='symbol'>:file_body</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_invalidate_-instance_route">
  
    #<strong>GET &#39;/search/:id/invalidate&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 207</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/invalidate</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:valid</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Search_marked_as_invalid</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_records_-instance_route">
  
    #<strong>GET &#39;/search/:id/records&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45
46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 41</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/records</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_systematic_review'>systematic_review</span>
  <span class='ivar'>@records</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_records_dataset'>records_dataset</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:author</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:searches/search_records</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_records_complete_doi_-instance_route">
  
    #<strong>GET &#39;/search/:id/records/complete_doi&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Completa la información desde Crossref para cada registro</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 77</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/records/complete_doi</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='ivar'>@records</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_records_dataset'>records_dataset</span>
  <span class='id identifier rubyid_rcp'>rcp</span><span class='op'>=</span><span class='const'>RecordCrossrefProcessor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@records</span><span class='comma'>,</span><span class='gvar'>$db</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_rcp'>rcp</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_references_-instance_route">
  
    #<strong>GET &#39;/search/:id/references&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 53</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/references</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_systematic_review'>systematic_review</span>
  <span class='ivar'>@references</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span>
  <span class='ivar'>@references_con_canonico</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_lit'>lit</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical_document_id IS NOT NULL</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='ivar'>@references_solo_doi</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_lit'>lit</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical_document_id IS NULL AND doi IS NOT NULL</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='ivar'>@n_references</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>n_references</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='int'>20</span> <span class='op'>:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>n_references</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='ivar'>@rmc_canonico</span>     <span class='op'>=</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_references_with_canonical_n'>references_with_canonical_n</span><span class='lparen'>(</span><span class='ivar'>@n_references</span><span class='rparen'>)</span>

  <span class='ivar'>@rmc_sin_canonico</span> <span class='op'>=</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_references_wo_canonical_n'>references_wo_canonical_n</span><span class='lparen'>(</span><span class='ivar'>@n_references</span><span class='rparen'>)</span>

  <span class='ivar'>@rmc_sin_canonico_con_doi</span> <span class='op'>=</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_references_wo_canonical_w_doi_n'>references_wo_canonical_w_doi_n</span><span class='lparen'>(</span><span class='ivar'>@n_references</span><span class='rparen'>)</span>

  <span class='comment'>##$log.info(@rmc_canonico)
</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:searches/search_references</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_references_generate_canonical_doi__n_-instance_route">
  
    #<strong>GET &#39;/search/:id/references/generate_canonical_doi/:n&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 107</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/references/generate_canonical_doi/:n</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_search'>search</span><span class='op'>=</span><span class='const'>Search</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_col_dois'>col_dois</span><span class='op'>=</span><span class='id identifier rubyid_search'>search</span><span class='period'>.</span><span class='id identifier rubyid_references_wo_canonical_w_doi_n'>references_wo_canonical_w_doi_n</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_col_dois'>col_dois</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_col_doi'>col_doi</span><span class='op'>|</span>
    <span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_col_doi'>col_doi</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_add_doi'>add_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_col_doi'>col_doi</span><span class='lbracket'>[</span><span class='symbol'>:doi</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_references_search_doi_-instance_route">
  
    #<strong>GET &#39;/search/:id/references/search_doi&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Busca en el text algun indicador de DOI</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 90</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/references/search_doi</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exitos'>exitos</span><span class='op'>=</span><span class='int'>0</span>
  <span class='ivar'>@search</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoSearchIdError.html" title="Buhos::NoSearchIdError (class)">NoSearchIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='ivar'>@references</span><span class='op'>=</span><span class='ivar'>@search</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='ivar'>@references</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_reference'>reference</span><span class='op'>|</span>
      <span class='id identifier rubyid_rp'>rp</span><span class='op'>=</span><span class='const'>ReferenceProcessor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_reference'>reference</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_exitos'>exitos</span><span class='op'>+=</span><span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_rp'>rp</span><span class='period'>.</span><span class='id identifier rubyid_process_doi'>process_doi</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Search_add_doi_references</span><span class='comma'>,</span> <span class='symbol'>:count</span><span class='op'>=&gt;</span><span class='id identifier rubyid_exitos'>exitos</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___search__id_validate_-instance_route">
  
    #<strong>GET &#39;/search/:id/validate&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202
203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 200</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/:id/validate</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="Search.html" title="Search (class)">Search</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:valid</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Search_marked_as_valid</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tag__tag_id_rs__rs_id_cds_-instance_route">
  
    #<strong>GET &#39;/tag/:tag_id/rs/:rs_id/cds&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 92</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tag/:tag_id/rs/:rs_id/cds</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@tag</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Tag.html" title="Tag (class)">Tag</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoTagIdError.html" title="Buhos::NoTagIdError (class)">NoTagIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_tag_id'>tag_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@tag</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>

  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>

  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='ivar'>@tag</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='ivar'>@cds_tag</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_cds_rs_tag'><span class='object_link'><a href="TagInCd.html#cds_rs_tag-class_method" title="TagInCd.cds_rs_tag (method)">cds_rs_tag</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='comma'>,</span><span class='ivar'>@tag</span><span class='rparen'>)</span>
  <span class='ivar'>@cds</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@cds_tag</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/rs_cds</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tag__tag_id_rs__rs_id_stage__stage_cds_-instance_route">
  
    #<strong>GET &#39;/tag/:tag_id/rs/:rs_id/stage/:stage/cds&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 74</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tag/:tag_id/rs/:rs_id/stage/:stage/cds</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@tag</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Tag.html" title="Tag (class)">Tag</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoTagIdError.html" title="Buhos::NoTagIdError (class)">NoTagIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_tag_id'>tag_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@tag</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>

  <span class='ivar'>@ars</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="AnalysisSystematicReview.html" title="AnalysisSystematicReview (class)">AnalysisSystematicReview</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalysisSystematicReview.html#initialize-instance_method" title="AnalysisSystematicReview#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='rparen'>)</span>

  <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='ivar'>@tag</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@stage</span><span class='op'>=</span><span class='id identifier rubyid_stage'>stage</span>
  <span class='ivar'>@cds_tag</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_cds_rs_tag'><span class='object_link'><a href="TagInCd.html#cds_rs_tag-class_method" title="TagInCd.cds_rs_tag (method)">cds_rs_tag</a></span></span><span class='lparen'>(</span><span class='ivar'>@review</span><span class='comma'>,</span><span class='ivar'>@tag</span><span class='comma'>,</span><span class='kw'>false</span><span class='comma'>,</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
  <span class='ivar'>@cds</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='ivar'>@cds_tag</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/rs_cds</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tags_basic_10_json_-instance_route">
  
    #<strong>GET &#39;/tags/basic_10.json&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192
193
194
195
196
197
198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 190</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/basic_10.json</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>json</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>
  <span class='const'><span class='object_link'><a href="Tag.html" title="Tag (class)">Tag</a></span></span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='lbrace'>{</span><span class='label'>id:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>value:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>tokens:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tags_basic_ref_10_json_-instance_route">
  
    #<strong>GET &#39;/tags/basic_ref_10.json&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205
206
207
208
209
210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 203</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/basic_ref_10.json</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>json</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>
  <span class='const'><span class='object_link'><a href="Tag.html" title="Tag (class)">Tag</a></span></span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='lbrace'>{</span><span class='label'>id:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>value:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>tokens:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tags_query_json__query_-instance_route">
  
    #<strong>GET &#39;/tags/query_json/:query&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217
218
219
220
221
222
223
224
225
226
227</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 215</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/query_json/:query</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>json</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>

  <span class='id identifier rubyid_res'>res</span><span class='op'>=</span><span class='gvar'>$db</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT id, text,COUNT(*) as n from tags t INNER JOIN tag_in_cds tec ON t.id=tec.tag_id WHERE INSTR(text,?)&gt;0 and decision=&#39;yes&#39; GROUP BY t.text ORDER BY n DESC LIMIT 10</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='lbrace'>{</span><span class='label'>id:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>value:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>tokens:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tags_refs_query_json__query_-instance_route">
  
    #<strong>GET &#39;/tags/refs/query_json/:query&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 230</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/refs/query_json/:query</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>json</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>

  <span class='id identifier rubyid_res'>res</span><span class='op'>=</span><span class='gvar'>$db</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT id, text,COUNT(*) as n from tags t INNER JOIN tag_bw_cds tec ON t.id=tec.tag_id WHERE INSTR(text,?)&gt;0 and decision=&#39;yes&#39; GROUP BY t.text ORDER BY n DESC LIMIT 10</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='lbrace'>{</span><span class='label'>id:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>value:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>tokens:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tags_systematic_review__rs_id_query_json__query_-instance_route">
  
    #<strong>GET &#39;/tags/systematic_review/:rs_id/query_json/:query&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252
253
254
255
256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 246</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/systematic_review/:rs_id/query_json/:query</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>json</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>
  
  <span class='id identifier rubyid_res'>res</span><span class='op'>=</span><span class='gvar'>$db</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT id, text,COUNT(*) as n from tags t INNER JOIN tag_in_cds tec ON t.id=tec.tag_id WHERE INSTR(text,?)&gt;0 and decision=&#39;yes&#39; and systematic_review_id=? GROUP BY t.text ORDER BY n DESC LIMIT 10</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='rbracket'>]</span>
  <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='lbrace'>{</span><span class='label'>id:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>value:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>tokens:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___tags_systematic_review__rs_id_ref_query_json__query_-instance_route">
  
    #<strong>GET &#39;/tags/systematic_review/:rs_id/ref/query_json/:query&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268
269
270
271
272</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 260</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/systematic_review/:rs_id/ref/query_json/:query</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>json</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>

  <span class='id identifier rubyid_res'>res</span><span class='op'>=</span><span class='gvar'>$db</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT id, text,COUNT(*) as n from tags t INNER JOIN tag_bw_cds tec ON t.id=tec.tag_id WHERE INSTR(text,?)&gt;0 and decision=&#39;yes&#39; and systematic_review_id=? GROUP BY t.text ORDER BY n DESC LIMIT 10</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='rbracket'>]</span>
  <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='lbrace'>{</span><span class='label'>id:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>value:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='label'>tokens:</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___user__user_id_-instance_route">
  
    #<strong>GET &#39;/user/:user_id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 8</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/:user_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_user_id'>new_user_id</span><span class='op'>=</span><span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_create_new_user'>create_new_user</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>language</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_new_user_id'>new_user_id</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='ivar'>@usuario</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@usuario</span>

  <span class='comment'># Debo reemplazar por las elecciones de acuerdo a equipo
</span>
  <span class='ivar'>@have_permit</span> <span class='op'>=</span> <span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='ivar'>@usuario</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>

  <span class='ivar'>@rss</span><span class='op'>=</span><span class='ivar'>@usuario</span><span class='period'>.</span><span class='id identifier rubyid_systematic_reviews'>systematic_reviews</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:active</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>

  <span class='ivar'>@select_role</span><span class='op'>=</span><span class='id identifier rubyid_get_xeditable_select'>get_xeditable_select</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ac'>ac</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_ac'>ac</span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='semicolon'>;</span><span class='id identifier rubyid_ac'>ac</span><span class='rbrace'>}</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/edit/rol_id</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>select_role</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@select_role</span><span class='period'>.</span><span class='id identifier rubyid_active'>active</span><span class='op'>=</span><span class='kw'>false</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='op'>==</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='ivar'>@select_active_user</span><span class='op'>=</span><span class='id identifier rubyid_get_xeditable_select_bool'>get_xeditable_select_bool</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/edit/activa</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>select_active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@select_active_user</span><span class='period'>.</span><span class='id identifier rubyid_active'>active</span><span class='op'>=</span><span class='kw'>false</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='op'>==</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='ivar'>@select_language</span><span class='op'>=</span><span class='id identifier rubyid_get_xeditable_select'>get_xeditable_select</span><span class='lparen'>(</span><span class='id identifier rubyid_available_locales_hash'>available_locales_hash</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/edit/language</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>select_language</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@select_language</span><span class='period'>.</span><span class='id identifier rubyid_active'>active</span><span class='op'>=</span><span class='kw'>false</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='op'>!=</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:user</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___user__user_id_change_password_-instance_route">
  
    #<strong>GET &#39;/user/:user_id/change_password&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 119</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/:user_id/change_password</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>

  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@user</span>

  <span class='kw'>return</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users/change_password</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___user__user_id_compose_message_-instance_route">
  
    #<strong>GET &#39;/user/:user_id/compose_message&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 81</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/:user_id/compose_message</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@user</span>

  <span class='kw'>return</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='ivar'>@ms_id</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NEW</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@ms_text</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users/compose_message</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___user__user_id_edit_-instance_route">
  
    #<strong>GET &#39;/user/:user_id/edit&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 37</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/:user_id/edit</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/user/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_id'>user_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___user__user_id_messages_-instance_route">
  
    #<strong>GET &#39;/user/:user_id/messages&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 62</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/:user_id/messages</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>


  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message_view</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@user</span>

  <span class='ivar'>@messages_personal</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Message.html" title="Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:user_to</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_desc'>desc</span><span class='lparen'>(</span><span class='symbol'>:time</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='ivar'>@messages_personal_sent</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Message.html" title="Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:user_from</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='const'>Sequel</span><span class='period'>.</span><span class='id identifier rubyid_desc'>desc</span><span class='lparen'>(</span><span class='symbol'>:time</span><span class='rparen'>)</span><span class='rparen'>)</span>


  <span class='ivar'>@n_not_readed</span><span class='op'>=</span><span class='ivar'>@messages_personal</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:read</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='ivar'>@srs</span><span class='op'>=</span><span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_systematic_reviews'>systematic_reviews</span>

  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users/messages</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___ViewerJS__-instance_route">
  
    #<strong>GET &#39;/ViewerJS/&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 58</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ViewerJS/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_file'>send_file</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dir_base'>dir_base</span><span class='embexpr_end'>}</span><span class='tstring_content'>/public/ViewerJS/index.html</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___ViewerJS___file__id_download_-instance_route">
  
    #<strong>GET &#39;/ViewerJS/..file/:id/download&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 63</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ViewerJS/..file/:id/download</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'>#headers[&quot;Content-Disposition&quot;] = &quot;attachment;filename=#{file[:filename]}&quot;
</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='id identifier rubyid_file'>file</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span>
<span class='comment'>#  $log.info(File.size(file.absolute_path(dir_files)))
</span>  <span class='id identifier rubyid_send_file'>send_file</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_absolute_path'>absolute_path</span><span class='lparen'>(</span><span class='id identifier rubyid_dir_files'>dir_files</span><span class='rparen'>)</span><span class='rparen'>)</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET__group__id-instance_route">
  
    #<strong>GET /group/:id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Display information for a group</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/groups.rb', line 36</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/group/:id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@group</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='ivar'>@users_id</span><span class='op'>=</span><span class='ivar'>@group</span><span class='period'>.</span><span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:groups/view</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET__group__id_edit-instance_route">
  
    #<strong>GET /group/:id/edit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Display form to edit a group</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/groups.rb', line 19</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/group/:id/edit</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@group</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='ivar'>@users_id</span><span class='op'>=</span><span class='ivar'>@group</span><span class='period'>.</span><span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:groups/edit</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET__review__id-instance_route">
  
    #<strong>GET /review/:id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 50</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/:id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_view</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='comment'>##$log.info(@names_trs)
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
<span class='comment'>#  return 404 if !@review
</span>
  <span class='ivar'>@taxonomy_categories</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_taxonomy_categories_hash'>taxonomy_categories_hash</span>


  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/view</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET__review__id_edit-instance_route">
  
    #<strong>GET /review/:id/edit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 64</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/:id/edit</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@taxonomy_categories_id</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_taxonomy_categories_id'>taxonomy_categories_id</span>
  <span class='id identifier rubyid_title'>title</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Systematic_review_edit</span><span class='comma'>,</span> <span class='label'>sr_name:</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:systematic_reviews/edit</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___admin_users_update_-instance_route">
  
    #<strong>POST &#39;/admin/users/update&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update information for users</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/users.rb', line 26</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/users/update</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>usuario</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='id identifier rubyid_per'>per</span><span class='op'>|</span>
    <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>N</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_per'>per</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_data'>data</span><span class='op'>=</span><span class='id identifier rubyid_per'>per</span>
        <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_per'>per</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>active</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>active</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>?</span><span class='int'>1</span><span class='op'>:</span><span class='int'>0</span>
        <span class='id identifier rubyid_log'>log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_per'>per</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>borrar</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_data'>data</span><span class='op'>=</span><span class='id identifier rubyid_per'>per</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_per'>per</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_per'>per</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>active</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>active</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>?</span><span class='int'>1</span><span class='op'>:</span><span class='int'>0</span>
      <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___canonical_document__id_merge_similar_references_-instance_route">
  
    #<strong>POST &#39;/canonical_document/:id/merge_similar_references&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78
79
80
81
82
83
84
85</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 76</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/:id/merge_similar_references</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_references_a_unir'>references_a_unir</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
    <span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_references_a_unir'>references_a_unir</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='ivar'>@cd</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Se unieron </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_references_a_unir'>references_a_unir</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> references al canonico comun </span><span class='embexpr_beg'>#{</span><span class='ivar'>@cd</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___canonical_document_merge_-instance_route">
  
    #<strong>POST &#39;/canonical_document/merge&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 99</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/merge</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_doi'>doi</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>doi</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_pk_ids'>pk_ids</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk_ids</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_doi'>doi</span>
    <span class='id identifier rubyid_cds'>cds</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:doi</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_doi'>doi</span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pk_ids'>pk_ids</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_cds'>cds</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='op'>&gt;</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_resultado'>resultado</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='period'>.</span><span class='id identifier rubyid_unir'>unir</span><span class='lparen'>(</span><span class='id identifier rubyid_cds'>cds</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_resultado'>resultado</span> <span class='op'>?</span> <span class='int'>200</span> <span class='op'>:</span> <span class='int'>500</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___canonical_document_user_assignation__accion_-instance_route">
  
    #<strong>POST &#39;/canonical_document/user_assignation/:accion&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 154</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/user_assignation/:accion</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_accion'>accion</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_revision'>revision</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rs_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_user'>user</span><span class='op'>=</span><span class='const'>User</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_stage'>stage</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stage</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_revision'>revision</span> <span class='kw'>or</span> <span class='op'>!</span><span class='id identifier rubyid_cd'>cd</span> <span class='kw'>or</span> <span class='op'>!</span><span class='id identifier rubyid_user'>user</span> <span class='kw'>or</span> <span class='op'>!</span><span class='id identifier rubyid_stage'>stage</span>
  <span class='id identifier rubyid_a_cd'>a_cd</span><span class='op'>=</span><span class='const'>AllocationCd</span><span class='lbracket'>[</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_revision'>revision</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user'>user</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>asignar</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_a_cd'>a_cd</span>
      <span class='const'><span class='object_link'><a href="AllocationCd.html" title="AllocationCd (class)">AllocationCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_revision'>revision</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user'>user</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span><span class='symbol'>:status</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>assigned</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='int'>200</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>desasignar</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_a_cd'>a_cd</span>
      <span class='id identifier rubyid_a_cd'>a_cd</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
      <span class='kw'>return</span> <span class='int'>200</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>500</span><span class='comma'>,</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:that_function_doesn_exists</span><span class='rparen'>)</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___decision_review__review_id_user__user_id_canonical_document__cd_id_stage__stage_decision_-instance_route">
  
    #<strong>POST &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/decision&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/decision.rb', line 41</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/decision</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='comment'>#cd_id=params[&#39;pk_id&#39;]
</span>  <span class='id identifier rubyid_decision'>decision</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>decision</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='comment'>#user_id=params[&#39;user_id&#39;]
</span>  <span class='id identifier rubyid_only_buttons'>only_buttons</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>only_buttons</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>

  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_des'>des</span><span class='op'>=</span><span class='const'>Decision</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span> <span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:stage</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_des'>des</span>
      <span class='id identifier rubyid_des'>des</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:decision</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_decision'>decision</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='const'><span class='object_link'><a href="Decision.html" title="Decision (class)">Decision</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span>
                      <span class='symbol'>:decision</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_decision'>decision</span><span class='comma'>,</span>
                      <span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:stage</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_review'>review</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_review_id'>review_id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_ars'>ars</span><span class='op'>=</span><span class='const'>AnalysisSystematicReview</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_review'>review</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_decisions'>decisions</span><span class='op'>=</span><span class='const'>Decision</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:systematic_review_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span>
                            <span class='symbol'>:stage</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_as_hash'>as_hash</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='rparen'>)</span>


  <span class='kw'>return</span> <span class='id identifier rubyid_partial'>partial</span><span class='lparen'>(</span><span class='symbol'>:decision</span><span class='comma'>,</span> <span class='symbol'>:locals</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='label'>review:</span> <span class='id identifier rubyid_review'>review</span><span class='comma'>,</span> <span class='label'>cd:</span> <span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span> <span class='label'>decisions:</span> <span class='id identifier rubyid_decisions'>decisions</span><span class='comma'>,</span> <span class='label'>ars:</span> <span class='id identifier rubyid_ars'>ars</span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='label'>stage:</span> <span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='label'>ajax:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>only_buttons:</span><span class='id identifier rubyid_only_buttons'>only_buttons</span><span class='rbrace'>}</span><span class='rparen'>)</span>


<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___file_assign_to_canonical_-instance_route">
  
    #<strong>POST &#39;/file/assign_to_canonical&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 157</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/assign_to_canonical</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_acd'>acd</span><span class='op'>=</span><span class='const'>FileCd</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>


  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_acd'>acd</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
    <span class='kw'>return</span> <span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file_handler.no_canonical_document</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_cd'>cd</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_acd'>acd</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='symbol'>:not_consider</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;a href=&#39;/canonical_document/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cd'>cd</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cd'>cd</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='int'>50</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/a&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___file_delete_-instance_route">
  
    #<strong>POST &#39;/file/delete&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225
226
227
228
229
230
231
232
233
234</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 224</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/delete</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>

  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='const'><span class='object_link'><a href="FileSr.html" title="FileSr (class)">FileSr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___file_hide_cd_-instance_route">
  
    #<strong>POST &#39;/file/hide_cd&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183
184
185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 181</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/hide_cd</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:not_consider</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___file_show_cd_-instance_route">
  
    #<strong>POST &#39;/file/show_cd&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195
196
197
198
199
200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 192</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/show_cd</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoFileIdError.html" title="Buhos::NoFileIdError (class)">NoFileIdError</a></span></span> <span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_file'>file</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NoCdIdError</span>   <span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_cd'>cd</span>

  <span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:not_consider</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___file_unassign_cd_-instance_route">
  
    #<strong>POST &#39;/file/unassign_cd&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205
206
207
208
209
210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 203</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/unassign_cd</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_file'>file</span><span class='op'>=</span><span class='const'>IFile</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoFileIdError.html" title="Buhos::NoFileIdError (class)">NoFileIdError</a></span></span> <span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_file'>file</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NoCdIdError</span>   <span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cd_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_cd'>cd</span>

  <span class='const'><span class='object_link'><a href="FileCd.html" title="FileCd (class)">FileCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___file_unassign_sr_-instance_route">
  
    #<strong>POST &#39;/file/unassign_sr&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 216</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/unassign_sr</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rs'>rs</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rs_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_rs'>rs</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_file_Rs'>file_Rs</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rs'>rs</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___group_update_-instance_route">
  
    #<strong>POST &#39;/group/update&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates information for a group</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>#group/:id/edit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/groups.rb', line 62</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/group/update</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_id'>id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_name'>name</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:group_without_name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_description'>description</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_administrador'>administrador</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>group_administrator</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_users'>users</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>users</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>users</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NA</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_group'>group</span><span class='op'>=</span><span class='const'>Group</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span><span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='symbol'>:group_administrator</span><span class='op'>=&gt;</span><span class='id identifier rubyid_administrador'>administrador</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_id'>id</span><span class='op'>=</span><span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>else</span>
    <span class='const'><span class='object_link'><a href="Group.html" title="Group (class)">Group</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span><span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='symbol'>:group_administrator</span><span class='op'>=&gt;</span><span class='id identifier rubyid_administrador'>administrador</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='const'><span class='object_link'><a href="GroupsUser.html" title="GroupsUser (class)">GroupsUser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:group_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
    <span class='const'><span class='object_link'><a href="GroupsUser.html" title="GroupsUser (class)">GroupsUser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_u'>u</span><span class='comma'>,</span> <span class='symbol'>:group_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_url'>url</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/groups</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___message__m_id_seen_by__user_id_-instance_route">
  
    #<strong>POST &#39;/message/:m_id/seen_by/:user_id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24
25
26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/messages.rb', line 22</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/message/:m_id/seen_by/:user_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m_id'>m_id</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ms'>ms</span><span class='op'>=</span><span class='const'>Message</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m_id'>m_id</span><span class='comma'>,</span> <span class='symbol'>:user_to</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ms'>ms</span>
    <span class='id identifier rubyid_ms'>ms</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:read</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___message_per__m_id_reply_-instance_route">
  
    #<strong>POST &#39;/message_per/:m_id/reply&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/messages.rb', line 52</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/message_per/:m_id/reply</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m_id'>m_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_m_per'>m_per</span><span class='op'>=</span><span class='const'>Message</span><span class='lbracket'>[</span><span class='id identifier rubyid_m_id'>m_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@user_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='ivar'>@user_id</span><span class='rbracket'>]</span>


  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='ivar'>@user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@user</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'>NoMessageIdError</span><span class='comma'>,</span> <span class='id identifier rubyid_m_id'>m_id</span>     <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_m_per'>m_per</span>

  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='ivar'>@user_id</span><span class='rparen'>)</span>


  <span class='ivar'>@subject</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subject</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='ivar'>@text</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_id'>id</span><span class='op'>=</span><span class='const'>Message</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:user_from</span><span class='op'>=&gt;</span><span class='ivar'>@user_id</span><span class='comma'>,</span> <span class='symbol'>:user_to</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m_per'>m_per</span><span class='period'>.</span><span class='id identifier rubyid_user_from'>user_from</span> <span class='comma'>,</span> <span class='symbol'>:reply_to</span><span class='op'>=&gt;</span><span class='id identifier rubyid_m_per'>m_per</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:time</span><span class='op'>=&gt;</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:subject</span><span class='op'>=&gt;</span><span class='ivar'>@subject</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='op'>=&gt;</span><span class='ivar'>@text</span><span class='comma'>,</span> <span class='symbol'>:read</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages.add_reply_to</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>subject:</span> <span class='id identifier rubyid_m_per'>m_per</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___message_sr__ms_id_reply_-instance_route">
  
    #<strong>POST &#39;/message_sr/:ms_id/reply&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/messages.rb', line 33</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/message_sr/:ms_id/reply</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ms_id'>ms_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ms'>ms</span><span class='op'>=</span><span class='const'>MessageSr</span><span class='lbracket'>[</span><span class='id identifier rubyid_ms_id'>ms_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@user_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='ivar'>@user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='ivar'>@user_id</span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_ms'>ms</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@subject</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subject</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@text</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='const'><span class='object_link'><a href="MessageSr.html" title="MessageSr (class)">MessageSr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ms'>ms</span><span class='period'>.</span><span class='id identifier rubyid_systematic_review_id'>systematic_review_id</span><span class='comma'>,</span> <span class='symbol'>:user_from</span><span class='op'>=&gt;</span><span class='ivar'>@user_id</span><span class='comma'>,</span> <span class='symbol'>:reply_to</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ms'>ms</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:time</span><span class='op'>=&gt;</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:subject</span><span class='op'>=&gt;</span><span class='ivar'>@subject</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='op'>=&gt;</span><span class='ivar'>@text</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages.add_reply_to</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>subject:</span> <span class='id identifier rubyid_ms'>ms</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___message_sr__ms_id_seen_by__user_id_-instance_route">
  
    #<strong>POST &#39;/message_sr/:ms_id/seen_by/:user_id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/messages.rb', line 8</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/message_sr/:ms_id/seen_by/:user_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ms_id'>ms_id</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_ms'>ms</span><span class='op'>=</span><span class='const'>MessageSrSeen</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:m_rs_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ms_id'>ms_id</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>


  <span class='kw'>unless</span> <span class='id identifier rubyid_ms'>ms</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_ms'>ms</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:read</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'><span class='object_link'><a href="MessageSrSeen.html" title="MessageSrSeen (class)">MessageSrSeen</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:m_rs_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_ms_id'>ms_id</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span><span class='symbol'>:read</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___record__id_manual_references_-instance_route">
  
    #<strong>POST &#39;/record/:id/manual_references&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/records.rb', line 38</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/record/:id/manual_references</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>record_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ref_man'>ref_man</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference_manual</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span> <span class='op'>=&gt;</span> <span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ref_man'>ref_man</span>
      <span class='id identifier rubyid_partes'>partes</span><span class='op'>=</span><span class='id identifier rubyid_ref_man'>ref_man</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[ Links ]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_partes'>partes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parte'>parte</span><span class='op'>|</span>
        <span class='id identifier rubyid_ref'>ref</span><span class='op'>=</span><span class='const'>Reference</span><span class='period'>.</span><span class='id identifier rubyid_get_by_text_and_doi'>get_by_text_and_doi</span><span class='lparen'>(</span><span class='id identifier rubyid_parte'>parte</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_ref_reg'>ref_reg</span><span class='op'>=</span><span class='const'>RecordsReference</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:record_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:reference_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ref'>ref</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_ref_reg'>ref_reg</span>
          <span class='const'>RecordsReference</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:record_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:reference_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ref'>ref</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Agregadas </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_partes'>partes</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'> references</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___reference__id_merge_similar_references_-instance_route">
  
    #<strong>POST &#39;/reference/:id/merge_similar_references&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/references.rb', line 37</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/reference/:id/merge_similar_references</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@ref</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@ref</span><span class='lbracket'>[</span><span class='symbol'>:canonical_document_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No tengo método para unificar sin canonico</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_references_a_unir'>references_a_unir</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reference</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
    <span class='const'><span class='object_link'><a href="Reference.html" title="Reference (class)">Reference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_references_a_unir'>references_a_unir</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='ivar'>@ref</span><span class='lbracket'>[</span><span class='symbol'>:canonical_document_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Se unieron las references de </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_references_a_unir'>references_a_unir</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> references a un canonico comun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___resolution_review__id_canonical_document__cd_id_stage__stage_resolution_-instance_route">
  
    #<strong>POST &#39;/resolution/review/:id/canonical_document/:cd_id/stage/:stage/resolution&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/resolutions.rb', line 9</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/resolution/review/:id/canonical_document/:cd_id/stage/:stage/resolution</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_resolution'>resolution</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>resolution</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_user_id'>user_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='kw'>return</span> <span class='int'>500</span> <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>yes</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>no</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_resolution'>resolution</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>

    <span class='id identifier rubyid_res'>res</span><span class='op'>=</span><span class='const'>Resolution</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='const'><span class='object_link'><a href="Resolution.html" title="Resolution (class)">Resolution</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='symbol'>:resolution</span><span class='op'>=&gt;</span><span class='id identifier rubyid_resolution'>resolution</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:commentary</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Resuelto en forma especifica en </span><span class='embexpr_beg'>#{</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:resolution</span><span class='op'>=&gt;</span><span class='id identifier rubyid_resolution'>resolution</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:commentary</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Actualizado en forma especifica en </span><span class='embexpr_beg'>#{</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_review'>review</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_rev_id'>rev_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_ars'>ars</span><span class='op'>=</span><span class='const'>AnalysisSystematicReview</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_review'>review</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_rpc'>rpc</span><span class='op'>=</span><span class='id identifier rubyid_ars'>ars</span><span class='period'>.</span><span class='id identifier rubyid_resolution_by_cd'>resolution_by_cd</span> <span class='lparen'>(</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_partial'>partial</span><span class='lparen'>(</span><span class='symbol'>:buttons_resolution</span><span class='comma'>,</span> <span class='symbol'>:locals</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='symbol'>:rpc</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rpc'>rpc</span><span class='comma'>,</span> <span class='symbol'>:cd_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:review</span><span class='op'>=&gt;</span><span class='id identifier rubyid_review'>review</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___review__id_message_new_-instance_route">
  
    #<strong>POST &#39;/review/:id/message/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233
234
235
236
237
238
239
240
241
242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 231</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:id/message/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='ivar'>@user_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='ivar'>@user_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@subject</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subject</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@text</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_id'>id</span><span class='op'>=</span><span class='const'>MessageSr</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:user_from</span><span class='op'>=&gt;</span><span class='ivar'>@user_id</span><span class='comma'>,</span> <span class='symbol'>:reply_to</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:time</span><span class='op'>=&gt;</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:subject</span><span class='op'>=&gt;</span><span class='ivar'>@subject</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='op'>=&gt;</span><span class='ivar'>@text</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages.new_message_for_sr</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>sr_name:</span><span class='ivar'>@review</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___review__rs_id_new_field_-instance_route">
  
    #<strong>POST &#39;/review/:rs_id/new_field&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add a new field</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/fields.rb', line 24</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:rs_id/new_field</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>

  <span class='id identifier rubyid_name'>name</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>

  <span class='ivar'>@campo_previo</span><span class='op'>=</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@campo_previo</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='const'><span class='object_link'><a href="SrField.html" title="SrField (class)">SrField</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span> <span class='symbol'>:order</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>order</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='comma'>,</span><span class='symbol'>:options</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>options</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sr_new_sr_edit_field.doesnt_existfield.success</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>name:</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>else</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sr_new_field.duplicated</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>name:</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___review_files_add_-instance_route">
  
    #<strong>POST &#39;/review/files/add&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 260</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/files/add</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_edit</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'>#$log.info(params)
</span>  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>systematic_review_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@review</span>
  <span class='id identifier rubyid_files'>files</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>files</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='kw'>nil</span>
  <span class='id identifier rubyid_cd_id'>cd_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cd_id'>cd_id</span>
    <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_files'>files</span>
    <span class='id identifier rubyid_results'>results</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_files'>files</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
      <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="IFile.html" title="IFile (class)">IFile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_add_on_sr'><span class='object_link'><a href="IFile.html#add_on_sr-class_method" title="IFile.add_on_sr (method)">add_on_sr</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span><span class='ivar'>@review</span><span class='comma'>,</span><span class='id identifier rubyid_dir_files'>dir_files</span><span class='comma'>,</span><span class='id identifier rubyid_cd'>cd</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_add_result'>add_result</span> <span class='id identifier rubyid_results'>results</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Files_not_uploaded</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___review_update_-instance_route">
  
    #<strong>POST &#39;/review/update&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews.rb', line 76</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/update</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_id'>id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span>
  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>review_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>captures</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_strc'>strc</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>srtc</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='comment'>#No nulos
</span>  <span class='comment'>##$log.info(otros_params)
</span>  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='op'>=</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ac'>ac</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_ac'>ac</span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='semicolon'>;</span><span class='id identifier rubyid_ac'>ac</span>
  <span class='rbrace'>}</span>
  <span class='comment'>#  aa=SystematicReview.new
</span>  <span class='gvar'>$log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='rparen'>)</span>

  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_id'>id</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_revision'>revision</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_revision'>revision</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="Systematic_Review_SRTC.html" title="Systematic_Review_SRTC (class)">Systematic_Review_SRTC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:sr_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_strc'>strc</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='op'>!</span><span class='id identifier rubyid_strc'>strc</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_strc'>strc</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
        <span class='const'><span class='object_link'><a href="Systematic_Review_SRTC.html" title="Systematic_Review_SRTC (class)">Systematic_Review_SRTC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:sr_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:srtc_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='comment'># Procesamos los srtc
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_url'>url</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___role_update_-instance_route">
  
    #<strong>POST &#39;/role/update&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/admin/roles.rb', line 73</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/role/update</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_old_id'>old_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_id_old</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_new_id'>new_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>role_id_new</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_new_id'>new_id</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:role_without_name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
  <span class='kw'>end</span>

  <span class='ivar'>@role</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_old_id'>old_id</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@role</span>
  <span class='id identifier rubyid_exists_another'>exists_another</span><span class='op'>=</span><span class='const'>Role</span><span class='lbracket'>[</span><span class='id identifier rubyid_new_id'>new_id</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_old_id'>old_id</span><span class='op'>==</span><span class='id identifier rubyid_new_id'>new_id</span> <span class='kw'>or</span> <span class='op'>!</span><span class='id identifier rubyid_exists_another'>exists_another</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='const'><span class='object_link'><a href="AuthorizationsRole.html" title="AuthorizationsRole (class)">AuthorizationsRole</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:rol_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_old_id'>old_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>


      <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_old_id'>old_id</span><span class='op'>!=</span><span class='id identifier rubyid_new_id'>new_id</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unrestrict_primary_key'>unrestrict_primary_key</span>
        <span class='const'><span class='object_link'><a href="Role.html" title="Role (class)">Role</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_old_id'>old_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_new_id'>new_id</span><span class='comma'>,</span> <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='ivar'>@role</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>permits</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_authorization_i'>authorization_i</span><span class='op'>|</span>
        <span class='const'><span class='object_link'><a href="AuthorizationsRole.html" title="AuthorizationsRole (class)">AuthorizationsRole</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:rol_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_new_id'>new_id</span><span class='comma'>,</span><span class='symbol'>:authorization_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_authorization_i'>authorization_i</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Exists_another_role_with_that_name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/roles</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___search_update_-instance_route">
  
    #<strong>POST &#39;/search/update&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 124</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/search/update</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_id'>id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span>
  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>search_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>captures</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_archivo'>archivo</span><span class='op'>=</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='comment'>#No nulos
</span>
  <span class='id identifier rubyid_otros_params'>otros_params</span><span class='op'>=</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ac'>ac</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_ac'>ac</span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='semicolon'>;</span><span class='id identifier rubyid_ac'>ac</span>
  <span class='rbrace'>}</span>
  <span class='comment'>#  aa=SystematicReview.new
</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bibliographic_database_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:No_empty_bibliographic_database_on_search</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='kw'>else</span>


    <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_search'>search</span><span class='op'>=</span><span class='const'>Search</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
          <span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='lbracket'>[</span><span class='symbol'>:systematic_review_id</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:source</span><span class='op'>=&gt;</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:bibliographic_database_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='lbracket'>[</span><span class='symbol'>:bibliographic_database_id</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:date_creation</span><span class='op'>=&gt;</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='lbracket'>[</span><span class='symbol'>:date_creation</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:search_criteria</span><span class='op'>=&gt;</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='lbracket'>[</span><span class='symbol'>:search_criteria</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:description</span><span class='op'>=&gt;</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='lbracket'>[</span><span class='symbol'>:description</span><span class='rbracket'>]</span>
      <span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_search'>search</span><span class='op'>=</span><span class='const'>Search</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_search'>search</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_archivo'>archivo</span>
      <span class='id identifier rubyid_fp'>fp</span><span class='op'>=</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_archivo'>archivo</span><span class='lbracket'>[</span><span class='symbol'>:tempfile</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_search'>search</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:file_body</span><span class='op'>=&gt;</span><span class='id identifier rubyid_fp'>fp</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='comma'>,</span> <span class='symbol'>:filetype</span><span class='op'>=&gt;</span><span class='id identifier rubyid_archivo'>archivo</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='symbol'>:filename</span><span class='op'>=&gt;</span><span class='id identifier rubyid_archivo'>archivo</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fp'>fp</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/review/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_otros_params'>otros_params</span><span class='lbracket'>[</span><span class='symbol'>:systematic_review_id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/searches</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___searches_update_batch_-instance_route">
  
    #<strong>POST &#39;/searches/update_batch&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/searchs.rb', line 170</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/searches/update_batch</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='comment'>#$log.info(params)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:No_valid_action</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:No_search_selected</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_searches'>searches</span><span class='op'>=</span><span class='const'>Search</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>search</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>action</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valid</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_searches'>searches</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:valid</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>action</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invalid</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_searches'>searches</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:valid</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>action</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>delete</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_searches'>searches</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>action</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>process</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_results'>results</span><span class='op'>=</span><span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='id identifier rubyid_searches'>searches</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_search'>search</span><span class='op'>|</span>
        <span class='id identifier rubyid_sp'>sp</span><span class='op'>=</span><span class='const'>SearchProcessor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_search'>search</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_sp'>sp</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_result'>add_result</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:Action_not_defined</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>url_back</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___tag_delete_rs_-instance_route">
  
    #<strong>POST &#39;/tag/delete_rs&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


276
277
278
279
280
281
282
283
284
285
286
287
288</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 276</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tag/delete_rs</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rs'>rs</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rs_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_rs'>rs</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='const'><span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:tag_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rs'>rs</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
    <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:tag_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='kw'>and</span> <span class='const'><span class='object_link'><a href="TagBwCd.html" title="TagBwCd (class)">TagBwCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:tag_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='const'><span class='object_link'><a href="Tag.html" title="Tag (class)">Tag</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___tags_cd__cd_id_rs__rs_id__accion_-instance_route">
  
    #<strong>POST &#39;/tags/cd/:cd_id/rs/:rs_id/:accion&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 114</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/cd/:cd_id/rs/:rs_id/:accion</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span><span class='id identifier rubyid_accion'>accion</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cd'>cd</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_rs'>rs</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_rs'>rs</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_user_id'>user_id</span><span class='op'>=</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>add_tag</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_tag_name'>tag_name</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
    <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag_name'>tag_name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='period'>.</span><span class='id identifier rubyid_get_tag'>get_tag</span><span class='lparen'>(</span><span class='id identifier rubyid_tag_name'>tag_name</span><span class='rparen'>)</span>
    <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='const'><span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_approve_tag'><span class='object_link'><a href="TagInCd.html#approve_tag-class_method" title="TagInCd.approve_tag (method)">approve_tag</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>approve_tag</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_tag_id'>tag_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='lbracket'>[</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='const'><span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_approve_tag'><span class='object_link'><a href="TagInCd.html#approve_tag-class_method" title="TagInCd.approve_tag (method)">approve_tag</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reject_tag</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_tag_id'>tag_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='lbracket'>[</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='const'><span class='object_link'><a href="TagInCd.html" title="TagInCd (class)">TagInCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_reject_tag'><span class='object_link'><a href="TagInCd.html#reject_tag-class_method" title="TagInCd.reject_tag (method)">reject_tag</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>405</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I don&#39;t know the action to perform</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_partial'>partial</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags/tags_cd_rs</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='label'>cd:</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span> <span class='label'>review:</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span> <span class='symbol'>:nuevo</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___tags_cd_start__cd_start_id_cd_end__cd_end_id_rs__rs_id__accion_-instance_route">
  
    #<strong>POST &#39;/tags/cd_start/:cd_start_id/cd_end/:cd_end_id/rs/:rs_id/:accion&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 151</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/cd_start/:cd_start_id/cd_end/:cd_end_id/rs/:rs_id/:accion</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cd_start_id'>cd_start_id</span><span class='comma'>,</span><span class='id identifier rubyid_cd_end_id'>cd_end_id</span><span class='comma'>,</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span><span class='id identifier rubyid_accion'>accion</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cd_start'>cd_start</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_start_id'>cd_start_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cd_end'>cd_end</span><span class='op'>=</span><span class='const'>CanonicalDocument</span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_end_id'>cd_end_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_rs'>rs</span><span class='op'>=</span><span class='const'>SystematicReview</span><span class='lbracket'>[</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='id identifier rubyid_cd_start'>cd_start</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_cd_end'>cd_end</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_rs'>rs</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>add_tag</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_tag_name'>tag_name</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
    <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag_name'>tag_name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='period'>.</span><span class='id identifier rubyid_get_tag'>get_tag</span><span class='lparen'>(</span><span class='id identifier rubyid_tag_name'>tag_name</span><span class='rparen'>)</span>
    <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='const'><span class='object_link'><a href="TagBwCd.html" title="TagBwCd (class)">TagBwCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_approve_tag'><span class='object_link'><a href="TagBwCd.html#approve_tag-class_method" title="TagBwCd.approve_tag (method)">approve_tag</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd_start'>cd_start</span><span class='comma'>,</span><span class='id identifier rubyid_cd_end'>cd_end</span><span class='comma'>,</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>approve_tag</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_tag_id'>tag_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='lbracket'>[</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='const'><span class='object_link'><a href="TagBwCd.html" title="TagBwCd (class)">TagBwCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_approve_tag'><span class='object_link'><a href="TagBwCd.html#approve_tag-class_method" title="TagBwCd.approve_tag (method)">approve_tag</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd_start'>cd_start</span><span class='comma'>,</span><span class='id identifier rubyid_cd_end'>cd_end</span><span class='comma'>,</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_accion'>accion</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reject_tag</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_tag_id'>tag_id</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='lbracket'>[</span><span class='id identifier rubyid_tag_id'>tag_id</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='const'><span class='object_link'><a href="TagBwCd.html" title="TagBwCd (class)">TagBwCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_reject_tag'><span class='object_link'><a href="TagBwCd.html#reject_tag-class_method" title="TagBwCd.reject_tag (method)">reject_tag</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd_start'>cd_start</span><span class='comma'>,</span><span class='id identifier rubyid_cd_end'>cd_end</span><span class='comma'>,</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>405</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I don&#39;t know the action to perform</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_partial'>partial</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags/tags_cd_rs_ref</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='label'>cd_start:</span> <span class='id identifier rubyid_cd_start'>cd_start</span><span class='comma'>,</span> <span class='label'>cd_end:</span><span class='id identifier rubyid_cd_end'>cd_end</span><span class='comma'>,</span> <span class='label'>review:</span><span class='id identifier rubyid_rs'>rs</span><span class='comma'>,</span> <span class='symbol'>:nuevo</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___tags_class__t_clase_id_add_tag_-instance_route">
  
    #<strong>POST &#39;/tags/class/:t_clase_id/add_tag&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 48</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/class/:t_clase_id/add_tag</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t_clase_id'>t_clase_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_t_class'>t_class</span><span class='op'>=</span><span class='const'>T_Class</span><span class='lbracket'>[</span><span class='id identifier rubyid_t_clase_id'>t_clase_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span>  <span class='const'>NoTagClassIdError</span><span class='comma'>,</span> <span class='id identifier rubyid_t_clase_id'>t_clase_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_t_class'>t_class</span>
  <span class='id identifier rubyid_tag_name'>tag_name</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag_name'>tag_name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='period'>.</span><span class='id identifier rubyid_get_tag'>get_tag</span><span class='lparen'>(</span><span class='id identifier rubyid_tag_name'>tag_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t_class'>t_class</span><span class='period'>.</span><span class='id identifier rubyid_allocate_tag'>allocate_tag</span><span class='lparen'>(</span><span class='id identifier rubyid_tag'>tag</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_partial'>partial</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags/tags_class</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='label'>t_class:</span> <span class='id identifier rubyid_t_class'>t_class</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___tags_class__t_clase_id_remove_tag_-instance_route">
  
    #<strong>POST &#39;/tags/class/:t_clase_id/remove_tag&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 61</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/class/:t_clase_id/remove_tag</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t_clase_id'>t_clase_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t_class'>t_class</span><span class='op'>=</span><span class='const'>T_Class</span><span class='lbracket'>[</span><span class='id identifier rubyid_t_clase_id'>t_clase_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span>  <span class='const'>NoTagClassIdError</span><span class='comma'>,</span> <span class='id identifier rubyid_t_clase_id'>t_clase_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_t_class'>t_class</span>

  <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='const'>Tag</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span>  <span class='const'>NoTagIdError</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_tag'>tag</span>

  <span class='id identifier rubyid_t_class'>t_class</span><span class='period'>.</span><span class='id identifier rubyid_deallocate_tag'>deallocate_tag</span><span class='lparen'>(</span><span class='id identifier rubyid_tag'>tag</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_partial'>partial</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags/tags_class</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='label'>t_class:</span> <span class='id identifier rubyid_t_class'>t_class</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___tags_classes_new_-instance_route">
  
    #<strong>POST &#39;/tags/classes/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 8</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/classes/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@review</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_stage'>stage</span><span class='op'>=</span>  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stage</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_stage'>stage</span><span class='op'>=</span><span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NIL</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span>  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='int'>404</span> <span class='kw'>if</span> <span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span><span class='op'>=&gt;</span><span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='const'><span class='object_link'><a href="T_Class.html" title="T_Class (class)">T_Class</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                   <span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='ivar'>@review</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
                   <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span>
                   <span class='symbol'>:type</span><span class='op'>=&gt;</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___user__user_id_change_password_-instance_route">
  
    #<strong>POST &#39;/user/:user_id/change_password&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 129</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/:user_id/change_password</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@user</span>


  <span class='kw'>return</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_password_1'>password_1</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_password_2'>password_2</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>repeat_password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_password_1'>password_1</span><span class='op'>!=</span><span class='id identifier rubyid_password_2'>password_2</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password.not_equal_password</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
  <span class='kw'>else</span>
    <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_change_password'>change_password</span><span class='lparen'>(</span><span class='id identifier rubyid_password_1'>password_1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='op'>::</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password.password_updated</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/user/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___user__user_id_compose_message_send_-instance_route">
  
    #<strong>POST &#39;/user/:user_id/compose_message/send&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 93</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/:user_id/compose_message/send</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>

  <span class='kw'>return</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_auth_to'>auth_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_is_session_user'>is_session_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@user</span>

  <span class='id identifier rubyid_subject'>subject</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subject</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='id identifier rubyid_text'>text</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='id identifier rubyid_destination'>destination</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>to</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@user_to</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_destination'>destination</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='ivar'>@user_to</span>
    <span class='const'><span class='object_link'><a href="Message.html" title="Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:user_from</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:user_to</span><span class='op'>=&gt;</span><span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='symbol'>:reply_to</span><span class='op'>=&gt;</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:time</span><span class='op'>=&gt;</span><span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:subject</span><span class='op'>=&gt;</span><span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='op'>=&gt;</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='symbol'>:read</span><span class='op'>=&gt;</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages.new_message_for_user</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_name:</span><span class='ivar'>@user_to</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>else</span>
    <span class='id identifier rubyid_add_message'>add_message</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='symbol'>:User_not_exists</span><span class='comma'>,</span> <span class='label'>user_id:</span><span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/user/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_id'>user_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/messages</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___authorization_user__user_id_review__rs_id_cd__cd_id_stage__stage_id_edit_instruction_-instance_route">
  
    #<strong>PUT &#39;/authorization/user/:user_id/review/:rs_id/cd/:cd_id/stage/:stage_id/edit_instruction&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buhos <a
href="https://github.com/clbustos/buhos">github.com/clbustos/buhos</a>
Copyright © 2016-2018, Claudio Bustos Navarrete All rights reserved.
Licensed BSD 3-Clause License See LICENSE file for more information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/assignation.rb', line 8</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/authorization/user/:user_id/review/:rs_id/cd/:cd_id/stage/:stage_id/edit_instruction</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span><span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='const'><span class='object_link'><a href="AllocationCd.html" title="AllocationCd (class)">AllocationCd</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_rs_id'>rs_id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:stage</span><span class='op'>=&gt;</span><span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:instruction</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___canonical_document_edit_field__field_-instance_route">
  
    #<strong>PUT &#39;/canonical_document/edit_field/:field&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Metodo rapido</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/canonical_document.rb', line 90</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/canonical_document/edit_field/:field</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canonical_document_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_pk'>pk</span><span class='rbracket'>]</span>
  <span class='ivar'>@cd</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___decision_review__review_id_user__user_id_canonical_document__cd_id_stage__stage_commentary_-instance_route">
  
    #<strong>PUT &#39;/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/commentary&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/decision.rb', line 23</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/decision/review/:review_id/user/:user_id/canonical_document/:cd_id/stage/:stage/commentary</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span> <span class='id identifier rubyid_stage'>stage</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='gvar'>$db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:rollback</span> <span class='op'>=&gt;</span> <span class='symbol'>:reraise</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_des'>des</span><span class='op'>=</span><span class='const'>Decision</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span> <span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pk'>pk</span><span class='comma'>,</span> <span class='symbol'>:stage</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_stage'>stage</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_des'>des</span>
      <span class='id identifier rubyid_des'>des</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:commentary</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='const'><span class='object_link'><a href="Decision.html" title="Decision (class)">Decision</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='symbol'>:systematic_review_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span>
                      <span class='symbol'>:decision</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
                      <span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='symbol'>:canonical_document_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pk'>pk</span><span class='comma'>,</span> <span class='symbol'>:stage</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_stage'>stage</span><span class='comma'>,</span> <span class='symbol'>:commentary</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___file_edit_field__campo_-instance_route">
  
    #<strong>PUT &#39;/file/edit_field/:campo&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Method put</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


238
239
240
241
242
243
244
245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/files.rb', line 238</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/file/edit_field/:campo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='int'>505</span> <span class='kw'>unless</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>filename</span><span class='words_sep'> </span><span class='tstring_content'>filetype</span><span class='words_sep'>}</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_field'>field</span>
  <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@arc</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="IFile.html" title="IFile (class)">IFile</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_pk'>pk</span><span class='rbracket'>]</span>
  <span class='ivar'>@arc</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___review__sr_id_extract_information_cd__cd_id_user__user_id_update_field_-instance_route">
  
    #<strong>PUT &#39;/review/:sr_id/extract_information/cd/:cd_id/user/:user_id/update_field&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update information of a specific personalized field</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/extract_information.rb', line 58</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/:sr_id/extract_information/cd/:cd_id/user/:user_id/update_field</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='comma'>,</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='comma'>,</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_analyze</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@sr</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="SystematicReview.html" title="SystematicReview (class)">SystematicReview</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_sr_id'>sr_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoReviewIdError.html" title="Buhos::NoReviewIdError (class)">NoReviewIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_sr_id'>sr_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@sr</span>

  <span class='ivar'>@cd</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="CanonicalDocument.html" title="CanonicalDocument (class)">CanonicalDocument</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_cd_id'>cd_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoCdIdError.html" title="Buhos::NoCdIdError (class)">NoCdIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_cd_id'>cd_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@cd</span>

  <span class='ivar'>@user</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@user</span>

  <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_fila'>fila</span><span class='op'>=</span><span class='ivar'>@sr</span><span class='period'>.</span><span class='id identifier rubyid_analysis_cd_user_row'>analysis_cd_user_row</span><span class='lparen'>(</span><span class='ivar'>@cd</span><span class='comma'>,</span><span class='ivar'>@user</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_value_store'>value_store</span><span class='op'>=</span><span class='kw'>nil</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_value_store'>value_store</span><span class='op'>=</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_value_store'>value_store</span><span class='op'>=</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='kw'>end</span>

  <span class='ivar'>@sr</span><span class='period'>.</span><span class='id identifier rubyid_analysis_cd'>analysis_cd</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_fila'>fila</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value_store'>value_store</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___review_edit_field__attr_id__attr_-instance_route">
  
    #<strong>PUT &#39;/review/edit_field/:attr_id/:attr&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Edit specific attribute of a field</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48
49
50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/reviews/fields.rb', line 43</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/review/edit_field/:attr_id/:attr</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attr_id'>attr_id</span><span class='comma'>,</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>review_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>500</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sr_edit_field.invalid</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>field:</span><span class='id identifier rubyid_attr'>attr</span><span class='rparen'>)</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>order</span><span class='words_sep'> </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_content'>description</span><span class='words_sep'> </span><span class='tstring_content'>type</span><span class='words_sep'> </span><span class='tstring_content'>options</span><span class='words_sep'>}</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_attr'>attr</span>
  <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_campo_o'>campo_o</span><span class='op'>=</span><span class='const'>SrField</span><span class='lbracket'>[</span><span class='id identifier rubyid_pk'>pk</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sr_edit_field.doesnt_exist_db</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>field_id:</span><span class='id identifier rubyid_attr_id'>attr_id</span><span class='rparen'>)</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_attr'>attr</span>
  <span class='id identifier rubyid_campo_o'>campo_o</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='id identifier rubyid_attr'>attr</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___tags_classes_edit_field__field_-instance_route">
  
    #<strong>PUT &#39;/tags/classes/edit_field/:field&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 26</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tags/classes/edit_field/:field</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NIL</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>unless</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_content'>stage</span><span class='words_sep'> </span><span class='tstring_content'>type</span><span class='words_sep'>}</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_field'>field</span>
  <span class='const'><span class='object_link'><a href="T_Class.html" title="T_Class (class)">T_Class</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_pk'>pk</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT___user_edit__field_-instance_route">
  
    #<strong>PUT &#39;/user/edit/:field&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/user.rb', line 43</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/edit/:field</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_put_editable'>put_editable</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_user'>user</span><span class='op'>=</span><span class='const'>User</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Buhos.html" title="Buhos (module)">Buhos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Buhos/NoUserIdError.html" title="Buhos::NoUserIdError (class)">NoUserIdError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_user'>user</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>login</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:login</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_exclude'>exclude</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='op'>=&gt;</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='op'>&gt;</span><span class='int'>0</span>
      <span class='kw'>return</span> <span class='int'>405</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="PUT__tag_edit-instance_route">
  
    #<strong>PUT /tag/edit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'controllers/tag.rb', line 38</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tag/edit</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_halt_unless_auth'>halt_unless_auth</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tag_edit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pk</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>405</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Debe ingresar algun text</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><span class='object_link'><a href="Tag.html" title="Tag (class)">Tag</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_pk'>pk</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='op'>=&gt;</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>200</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Mar  3 02:48:38 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.4.1).
</div>

    </div>
  </body>
</html>